<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>ç¦å²¡äº”æ„Ÿç™‚ç™’ä¹‹æ—… 2026</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
/* â›” [ç³»çµ±æ ¸å¿ƒæ¨£å¼ - ç¦å²¡å±±å¹è‰²ç‰ˆ] */
:root {
    /* æ ¸å¿ƒé…è‰²ï¼šç§»æ¤è‡ª Source 2 */
    --bg-body: #1a2e47;        /* åšå¤šç£æ·±è— */
    --bg-card: #F7F9FC;        /* æ¥µç°¡ç°ç™½ */
    --text-main: #111111;      /* å¡ç‰‡å…§æ·±è‰²å­— */
    --text-sub: #666666;       /* æ¬¡è¦æ–‡å­— */
    --accent: #F8B500;         /* å±±å¹è‰² (é‡‘é»ƒ) */
    --accent-text: #2c2c2c;    /* é‡‘é»ƒè‰²ä¸Šçš„æ–‡å­—è‰² */
    --border: rgba(255,255,255,0.1); /* å¾®é€æ˜é‚Šæ¡† */
    --font-heading: "Zen Kaku Gothic New", sans-serif;
    --font-body: "Zen Kaku Gothic New", sans-serif;
    
    --shadow: 0 4px 15px rgba(0,0,0,0.2);
    --safe-top: env(safe-area-inset-top);
    --safe-bottom: env(safe-area-inset-bottom);
}
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
body { font-family: var(--font-body); background-color: var(--bg-body); color: #ffffff; margin: 0; padding: 0; height: 100dvh; display: flex; flex-direction: column; overflow: hidden; transition: all 0.3s ease; line-height: 1.5; font-size: 16px; }

/* Header */
header { background-color: rgba(26, 46, 71, 0.95); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border); padding: 0 15px; padding-top: var(--safe-top); height: calc(60px + var(--safe-top)); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; position: relative; z-index: 200; }
header h1 { margin: 0; font-size: 1.25rem; font-weight: 700; letter-spacing: 1px; color: #ffffff; font-family: var(--font-heading); }
#local-clock { font-size: 0.75rem; color: #aab8c2; font-weight: 500; margin-top: 2px; font-variant-numeric: tabular-nums; }
.header-actions { display: flex; align-items: center; gap: 10px; }
.header-btn { font-size: 1.2rem; cursor: pointer; color: #ffffff; width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; border-radius: 50%; transition: background 0.2s; }
.header-btn:active { background: rgba(255,255,255,0.1); }

/* Date Selector */
.date-selector-container { background: var(--bg-body); padding: 10px 0; border-bottom: 1px solid var(--border); width: 100%; flex-shrink: 0; position: relative; z-index: 90; box-shadow: var(--shadow); }
.date-selector { display: flex; gap: 8px; overflow-x: auto; scrollbar-width: none; padding: 0 15px; }
.date-chip { flex: 0 0 auto; min-width: 60px; padding: 8px 12px; border-radius: 10px; cursor: pointer; color: #8faab9; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.05); transition: all 0.2s; }
.date-chip.active { background: var(--accent); color: var(--accent-text); border-color: var(--accent); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(248, 181, 0, 0.3); font-weight: 700; }
.day-num { font-size: 1.1rem; line-height: 1; margin-bottom: 3px; font-family: var(--font-heading); } 
.day-week { font-size: 0.7rem; font-weight: 500; opacity: 0.9; }

/* Main Structure */
main { flex: 1; overflow-y: hidden; position: relative; background: var(--bg-body); }
.page { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow-y: auto; padding: 15px 0 100px 0; display: none; opacity: 0; transition: opacity 0.2s ease; -webkit-overflow-scrolling: touch; }
.page.active { display: block; opacity: 1; z-index: 10; }
.page-header { padding: 0 15px; margin-bottom: 20px; }
.page-title { font-size: 1.6rem; font-weight: 700; margin: 0; color: #ffffff; font-family: var(--font-heading); }

/* Timeline */
.timeline-container { padding: 5px 15px; max-width: 800px; margin: 0 auto; }
.timeline-item { position: relative; padding-left: 25px; padding-bottom: 20px; border-left: 1px solid rgba(255,255,255,0.15); }
.timeline-item:last-child { border-left: 1px solid transparent; }
.timeline-item::before { content: ''; position: absolute; left: -4px; top: 18px; width: 7px; height: 7px; background: var(--accent); border-radius: 50%; box-shadow: 0 0 0 4px var(--bg-body); z-index: 2; }
.card { background-color: var(--bg-card); border-radius: 8px; padding: 18px; box-shadow: var(--shadow); cursor: pointer; position: relative; transition: transform 0.1s; border: none; min-height: auto; display: flex; flex-direction: column; justify-content: center; border-left: 4px solid transparent; color: var(--text-main); }
.card:active { transform: scale(0.98); opacity: 0.9; }
.card-nav-btn { position: absolute; top: 15px; right: 15px; width: 36px; height: 36px; border-radius: 50%; background: #ffffff; color: var(--text-main); display: flex; justify-content: center; align-items: center; font-size: 1rem; border: 1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
.card-title { font-size: 1.15rem; font-weight: 700; margin: 0 0 8px 0; line-height: 1.3; font-family: var(--font-heading); padding-right: 40px; color: #111; }
.card-time { font-size: 0.8rem; color: var(--text-sub); font-weight: 600; margin-bottom: 4px; display: block; }
.card-tag { font-size: 0.7rem; background: #eef2f5; padding: 3px 8px; border-radius: 4px; color: #555; font-weight: 500; display: inline-block; margin-right: 5px; margin-top: 5px; }
.card-tag.alert { background: #ffebee; color: #d63345; border: 1px solid #ffcdd2; }

/* Weather */
.weather-main-card { background: linear-gradient(135deg, #2b5876 0%, #4e4376 100%); color: #fff; border-radius: 12px; padding: 25px; margin: 0 15px 20px 15px; text-align: center; position: relative; overflow: hidden; box-shadow: var(--shadow); }
.weather-tag-badge { position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.2); padding: 4px 10px; font-size: 0.7rem; border-radius: 20px; font-weight: 600; backdrop-filter: blur(5px); }
.weather-header-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 10px; }
.weather-big-temp { font-size: 4rem; font-weight: 300; line-height: 1; font-family: var(--font-heading); margin: 10px 0; }
.weather-condition { font-size: 1.1rem; font-weight: 500; opacity: 1; margin-bottom: 2px; }
.weather-hl { font-size: 0.85rem; opacity: 0.8; }
.weather-main-icon { font-size: 2.5rem; opacity: 1; }
.section-label { padding: 0 15px; font-size: 0.8rem; font-weight: 700; color: #aab8c2; margin-bottom: 12px; display: block; letter-spacing: 1px; }
.hourly-container { display: flex; gap: 10px; overflow-x: auto; padding: 0 15px 15px 15px; scrollbar-width: none; }
.hourly-item { flex: 0 0 auto; width: 65px; background: rgba(255,255,255,0.05); border-radius: 8px; padding: 12px 5px; text-align: center; border: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; align-items: center; justify-content: space-between; height: 100px; color: #fff; }
.hourly-time { font-size: 0.75rem; color: #ccc; font-weight: 600; margin-bottom: 5px; }
.hourly-icon { font-size: 1.2rem; margin: 5px 0; color: var(--accent); }
.hourly-temp { font-size: 0.95rem; font-weight: 700; }
.advice-card { background: rgba(255,255,255,0.05); margin: 0 15px 25px 15px; padding: 20px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); display: flex; gap: 15px; align-items: flex-start; color: #fff; }
.advice-icon { width: 36px; height: 36px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 1.1rem; color: var(--accent); }
.advice-content h4 { margin: 0 0 6px 0; font-size: 0.95rem; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; font-weight: 700; }
.advice-content p { margin: 0; font-size: 0.9rem; color: #ddd; line-height: 1.6; }
.weather-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 0 15px 30px 15px; }
.weather-stat-card { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; justify-content: center; height: 90px; color: #fff; }
.ws-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
.ws-label { font-size: 0.7rem; color: #aaa; text-transform: uppercase; font-weight: 700; letter-spacing: 1px; }
.ws-icon { color: #aaa; font-size: 0.9rem; }
.ws-value { font-size: 1.3rem; font-weight: 500; color: #fff; font-family: var(--font-heading); }

/* Shopping */
.shopping-list { padding: 0 15px; }
.shop-item { background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 10px; display: flex; align-items: center; gap: 15px; border: none; box-shadow: var(--shadow); }
.shop-item.checked { opacity: 0.6; background: #e0e0e0; }
.shop-item input[type="checkbox"] { width: 22px; height: 22px; accent-color: var(--accent); border-radius: 4px; }
.shop-item label { flex: 1; font-size: 1rem; color: var(--text-main); font-weight: 500; }

/* Inspiration */
.filter-bar-container { padding: 0 15px 15px 15px; position: sticky; top: 0; z-index: 50; background: var(--bg-body); overflow-x: auto; white-space: nowrap; scrollbar-width: none; border-bottom: 1px solid var(--border); margin-bottom: 15px; }
.filter-chip { display: inline-block; padding: 8px 16px; margin-right: 8px; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; font-size: 0.85rem; color: #ccc; cursor: pointer; transition: all 0.2s; font-weight: 500; }
.filter-chip.active { background: var(--accent); color: var(--accent-text); border-color: var(--accent); font-weight: 700; }
.inspire-card { background: var(--bg-card); border: none; border-radius: 8px; padding: 20px; color: var(--text-main); position: relative; display: flex; flex-direction: column; justify-content: center; margin-bottom: 15px; cursor: pointer; min-height: 90px; box-shadow: var(--shadow); border-left: 4px solid #ddd; }
.inspire-card[data-tag="BACKUP"] { border-left-color: var(--accent); background: #fffcf0; }
.inspire-card:active { transform: scale(0.98); }
.inspire-card.hidden { display: none; }
.inspire-badge { background: #333; color: #fff; padding: 4px 10px; border-radius: 4px; font-size: 0.7rem; font-weight: 700; position: absolute; top: -10px; left: 15px; letter-spacing: 0.5px; }
.inspire-badge.backup { background: var(--accent); color: var(--accent-text); }
.inspire-title { font-size: 1.1rem; font-weight: 700; margin: 0 0 6px 0; font-family: var(--font-heading); color: #222; }
.inspire-note { font-size: 0.9rem; color: #555; line-height: 1.5; }

/* Info Page */
.info-card { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 8px; margin: 0 15px 15px 15px; border: 1px solid rgba(255,255,255,0.1); color: #fff; }
.info-header { font-weight: 700; margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; font-size: 1rem; color: var(--accent); }
.info-row { display: flex; gap: 15px; margin-bottom: 15px; align-items: flex-start; font-size: 0.95rem; color: #eee; line-height: 1.6; }
.info-icon { width: 24px; text-align: center; color: #aaa; flex-shrink: 0; font-size: 1rem; }
.flight-row { border-bottom: 1px dashed rgba(255,255,255,0.2); padding-bottom: 12px; margin-bottom: 12px; }
.flight-code { font-size: 1.2rem; font-weight: 800; color: #fff; display: flex; align-items: center; gap: 8px; }
.flight-time { font-size: 0.9rem; font-weight: 600; color: var(--accent); }

/* Modal */
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 3000; justify-content: center; align-items: end; backdrop-filter: blur(5px); } 
.modal.open { display: flex; }
.modal-content { background: var(--bg-card); color: var(--text-main); width: 100%; max-width: 600px; max-height: 90vh; border-radius: 16px 16px 0 0; padding: 0 0 30px 0; overflow-y: auto; animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); display: flex; flex-direction: column; box-shadow: 0 -10px 40px rgba(0,0,0,0.2); }
.modal-handle-container { width: 100%; height: 30px; display: flex; justify-content: center; align-items: center; flex-shrink: 0; background: #fff; border-radius: 16px 16px 0 0; border-bottom: 1px solid #eee; }
.modal-handle { width: 40px; height: 5px; background: #ddd; border-radius: 10px; }
.modal-body { padding: 0 25px 25px 25px; background: #fff; }
.modal-info-grid { display: grid; grid-template-columns: 1fr; gap: 12px; margin: 20px 0; background: #f8f8f8; padding: 15px; border-radius: 8px; }
.modal-row { display: flex; gap: 10px; align-items: center; }
.modal-icon { width: 24px; text-align: center; color: #888; }
.modal-label { font-size: 0.7rem; color: #888; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; margin-bottom: 4px; display: block; }
.modal-note-box { background: #fffcf0; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid var(--accent); font-size: 0.95rem; line-height: 1.7; color: #333; }
.btn-action { width: 100%; padding: 16px; border-radius: 8px; border: none; font-weight: 700; cursor: pointer; font-size: 1rem; text-align: center; margin-bottom:10px; display: flex; justify-content: center; align-items: center; gap: 8px; transition: transform 0.1s; }
.btn-action:active { transform: scale(0.98); }
.btn-black { background: var(--accent); color: var(--accent-text); box-shadow: 0 4px 10px rgba(248, 181, 0, 0.3); }
.btn-outline { background: #fff; border: 1px solid #ddd; color: #333; }

/* Nav */
nav.bottom-nav { position: fixed; bottom: 0; width: 100%; background-color: rgba(20, 35, 56, 0.98); display: flex; justify-content: space-around; padding: 10px 0 calc(15px + var(--safe-bottom)) 0; border-top: 1px solid rgba(255,255,255,0.1); z-index: 100; backdrop-filter: blur(10px); }
.nav-item { color: #8faab9; text-align: center; font-size: 0.7rem; cursor: pointer; width: 25%; transition: color 0.2s; opacity: 0.8; }
.nav-item.active { color: var(--accent); opacity: 1; font-weight: 600; }
.nav-item i { display: block; font-size: 1.3rem; margin-bottom: 5px; }

/* Sidebar & Utils */
#toast { position: fixed; top: 90px; left: 50%; transform: translateX(-50%); background: #333; color: #fff; padding: 12px 25px; border-radius: 30px; font-size: 0.9rem; z-index: 9999; opacity: 0; pointer-events: none; transition: opacity 0.3s; display: flex; align-items: center; gap: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); font-weight: 500; } #toast.show { opacity: 1; }
.sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.3s; backdrop-filter: blur(2px); } .sidebar-overlay.open { opacity: 1; pointer-events: all; }
.sidebar { position: fixed; top: 0; right: 0; width: 85%; max-width: 320px; height: 100%; background: var(--bg-body); color: #fff; z-index: 1001; transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); overflow-y: auto; padding: 25px 20px 100px 20px; padding-top: calc(25px + var(--safe-top)); box-shadow: -5px 0 20px rgba(0,0,0,0.2); } .sidebar.open { transform: translateX(0); }
.tool-box { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); margin-bottom: 15px; } 
.curr-input { width: 100%; padding: 10px; border: 1px solid rgba(255,255,255,0.2); border-radius: 6px; font-size: 1.2rem; text-align: center; background: rgba(0,0,0,0.2); color: #fff; font-weight: bold; }
.phrase-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); z-index: 5000; display: flex; flex-direction: column; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.3s; padding: 30px; } 
.phrase-overlay.active { opacity: 1; pointer-events: all; }
.phrase-big { font-size: 2.2rem; font-weight: 700; color: #111; line-height: 1.3; margin-bottom: 10px; text-align: center; font-family: var(--font-heading); }
.phrase-sub { font-size: 1.2rem; color: #666; margin-bottom: 30px; }
.close-phrase { padding: 12px 40px; border-radius: 30px; color: #fff; cursor: pointer; background: #333; font-weight: 600; box-shadow: 0 5px 15px rgba(0,0,0,0.1); border: none; font-size: 1rem; }

@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
</style>
</head>
<body>

<script>
// ============================================
//   âš™ï¸ 1. [æ ¸å¿ƒè¨­å®š - ç¦å²¡ç‰ˆ]
// ============================================
const CONFIG = {
    startDate: "2026-02-14", // æ ¹æ“š Source 2
    duration: 7
};

const DESTINATION = {
    name: "ç¦å²¡ Fukuoka",
    lat: 33.5902,
    lon: 130.4017,
    timezone: "Asia/Tokyo",
    currency: "jpy",
    currencyLabel: "JPY",
    baseCurrency: "HKD",
    appTitle: "FUKUOKA <span>2026</span>"
};

const TRIP_INFO = {
    visa: { type: "æ—¥æœ¬å…¥å¢ƒ", number: "QR Code Ready", expiry: "90 Days" },
    flights: [
        { type: "å»ç¨‹", flight: "UO6XX", date: "02/14", dep: "HKG 12:xx", arr: "FUK 17:10", note: "T2 ç™»æ©Ÿ", bookingRef: "6XYZ99" },
        { type: "å›ç¨‹", flight: "UO669", date: "02/20", dep: "FUK 16:05", arr: "HKG 19:xx", note: "åšå¤šå·´å£«ç¸½ç«™æ­è»Š", bookingRef: "6XYZ99" }
    ],
    hotels: [
        { name: "Hotel Wing International Hakata Shinkansen-guchi", address: "ç¦å²¡å¸‚åšå¤šåŒºåšå¤šé§…æ±1-17-17", phone: "+81924310489" }
    ],
    emergency: [
        { name: "è­¦å¯Ÿå±€ (Police)", phone: "110" },
        { name: "æ•‘è­·è»Š (Ambulance)", phone: "119" },
        { name: "å¤–äº¤éƒ¨æ€¥é›£æ•‘åŠ©", phone: "+81-80-1009-xxxx" }
    ]
};

// ============================================
//   ğŸ—ºï¸ 2. [è¡Œç¨‹èˆ‡éˆæ„Ÿ - å®¢è£½åŒ–æ•´åˆ]
// ============================================
const USER_ITINERARY = {
    "day1": { 
        "events": [
            { time: "17:10", title: "æŠµé”ç¦å²¡æ©Ÿå ´", type: "æŠµé”", price: "Bus Â¥310", address: "ç¦å²¡ç©ºæ¸¯ å›½éš›ç·šã‚¿ãƒ¼ãƒŸãƒŠãƒ«", coords: [33.5859, 130.4446], note: "å…¥å¢ƒå¾Œå»2è™Ÿä¹˜è»Šè™•æ­å·´å£«ã€‚é—œéµï¼šåœ¨ã€Œåšå¤šé§…ç­‘ç´«å£ã€ä¸‹è»Šã€‚", tags: ["ç§»å‹•", "å¿…è®€"], moodColor: "#F8B500" },
            { time: "18:00", title: "Check-in Hotel Wing", type: "ä½å®¿", address: "åšå¤šé§…æ±1-17-17", coords: [33.5905, 130.4235], address_jp: "ãƒ›ãƒ†ãƒ«ã‚¦ã‚£ãƒ³ã‚°ã‚¤ãƒ³ã‚¿ãƒ¼ãƒŠã‚·ãƒ§ãƒŠãƒ«åšå¤šæ–°å¹¹ç·šå£", note: "ä¸‹å·´å£«é¢å‘è»Šç«™å‘å³è½‰ï¼Œæ²¿å¤§é¦¬è·¯ç›´èµ°4åˆ†é˜ã€‚ä¸è¦éé¦¬è·¯ã€‚", tags: ["ç­‘ç´«å£"] },
            { time: "18:30", title: "ä½å‰é…’è²© (è²·æ¸…é…’)", type: "è³¼ç‰©", price: "Â¥2,000", address: "åšå¤šé§… Deitos Annex 1F", address_jp: "ä½å‰é…’è²© åšå¤šé§…åº—", note: "å¿…è²·ä¹å·é™å®šç„¡æ¿¾éç”ŸåŸé…’ã€‚", tags: ["æ¸…é…’"] },
            { time: "19:30", title: "åšå¤šç‰›è…¸é‹ å‰ç”°å±‹", type: "ç¾é£Ÿ", price: "Â¥2,500", address: "åšå¤šé§…æ±2-9-20", address_jp: "åšå¤šã‚‚ã¤é‹ å‰ç”°å±‹ ç·æœ¬åº—", note: "å¿…é»ï¼šå‘³å™Œå£å‘³ç‰›è…¸é‹ã€ç”Ÿå•¤é…’ã€‚", tags: ["ç‰›è…¸é‹"] }
        ],
        "shopping": ["ç„¡æ¿¾éç”ŸåŸé…’", "ç™½ç³¸é…’é€ "],
        "inspiration": [
            { title: "MaxValu 24H è¶…å¸‚", tag: "BACKUP", note: "å°±åœ¨åšå¤šç«™ç­‘ç´«å£é™„è¿‘ï¼Œæ·±å¤œé€›è¶…å¸‚é¦–é¸ã€‚è²·è‰è“ã€å„ªæ ¼ç•¶å®µå¤œã€‚", address: "åšå¤šé§…æ±", type: "è¶…å¸‚" },
            { title: "åšå¤šç«™é ‚æ¨“å¤œæ™¯", tag: "RELAX", note: "JRåšå¤šåŸé ‚æ¨“ç‡•å­å»£å ´ï¼Œå…è²»å¤œæ™¯ï¼Œç¨è™•å¥½åœ°æ–¹ã€‚", type: "æ™¯é»" }
        ]
    },
    "day2": { 
        "events": [
            { time: "09:00", title: "å¾€åŸå³¶é…’è—ç¥­", type: "äº¤é€š", price: "Â¥1,130", address: "JR è’æœ¨é§…", note: "ç­‘ç´«å£é€²ç«™ï¼Œæ­JRé¹¿å…’å³¶æœ¬ç·šåˆ°ã€Œè’æœ¨ç«™ã€ï¼Œè½‰æ¥é§è»Šã€‚", tags: ["ç§»å‹•"] },
            { time: "11:00", title: "åŸå³¶é…’è—ã³ã‚‰ã", type: "ç¥­å…¸", price: "Â¥3,000", address: "ä¹…ç•™ç±³å¸‚åŸå³¶ç”º", note: "ä¹å·æœ€å¤§æ—©æ˜¥é…’ç¥­ï¼è³¼è²·ç„¡é™è©¦é£²æˆ–è©¦é£²åˆ¸ã€‚å¿…åƒï¼šç‰¡è £é…é…’ã€é°»é­šé£¯ã€‚", tags: ["ç¥­å…¸", "å–é…’"] },
            { time: "16:30", title: "æ«›ç”°ç¥ç¤¾ & å·ç«¯å•†åº—è¡—", type: "æ™¯é»", address: "åšå¤šåŒºä¸Šå·ç«¯ç”º1-41", address_jp: "æ«›ç”°ç¥ç¤¾", note: "åšå¤šç¸½é®å®ˆã€‚å¿…çœ‹é£¾å±±ç¬ ã€éˆæ³‰é¶´ä¹‹äº•æˆ¶ã€‚", tags: ["ç¥ç¤¾"] },
            { time: "19:00", title: "é³¥é¶ç ”ç©¶å›£", type: "ç¾é£Ÿ", price: "Â¥3,000", address: "åšå¤šé§…å‰4-18-19", note: "ç¾ä»£é¢¨æ ¼ç‡’é³¥åº—ï¼Œé©åˆç¨éŠã€‚å¿…é»ï¼šåœ°é›ç‚­ç«ç‡’ã€‚", tags: ["ç‡’é³¥"] }
        ],
        "shopping": ["æ–°é…’", "é…’ç²•", "é…’å™¨"],
        "inspiration": [
            { title: "å·ç«¯å–„å“‰å»£å ´", tag: "TIRED", note: "å¦‚æœé…’ç¥­å¤ªç´¯ï¼Œå›å·ç«¯å•†åº—è¡—åƒç´…è±†æ¹¯åœ“ä¼‘æ¯ã€‚", address: "å·ç«¯å•†åº—è¡—", type: "ç”œé»" },
            { title: "åšå¤šå‚³çµ±å·¥è—é¤¨", tag: "BACKUP", note: "é›¨å¤©å‚™æ¡ˆï¼šå°±åœ¨æ«›ç”°ç¥ç¤¾æ—ï¼Œå®¤å…§åƒè§€åšå¤šç¹”ã€‚", address: "æ«›ç”°ç¥ç¤¾æ—", type: "åšç‰©é¤¨" }
        ]
    },
    "day3": { 
        "events": [
            { time: "09:30", title: "å·´å£«å¾€å¤ªå®°åºœ", type: "äº¤é€š", price: "Â¥610", address: "åšå¤šå·´å£«ç¸½ç«™", note: "åšå¤šå£å·´å£«ç¸½ç«™ 1F 11è™Ÿæœˆå°ï¼Œæ­ä¹˜ã€Œæ—…äººã€å·´å£«ã€‚", tags: ["å·´å£«"] },
            { time: "10:30", title: "å¤ªå®°åºœå¤©æ»¿å®®", type: "æ™¯é»", address: "å¤ªå®°åºœå¤©æº€å®®", note: "æŠ½ç±¤ç¥ˆç¦ã€æ‘¸å¾¡ç¥ç‰›ã€åƒæ¢…æé¤…ã€‚", tags: ["ç¥ç¤¾"] },
            { time: "13:00", title: "ç«ˆé–€ç¥ç¤¾ (è‰¯ç·£)", type: "æ™¯é»", address: "å®æº€å®® ç«ˆé–€ç¥ç¤¾", note: "æ±‚å§»ç·£è–åœ°ï¼Œè²·ç²‰ç´…ç·šçµå¾¡å®ˆã€‚æ­ç¤¾å€å·´å£«ã€Œã¾ã»ã‚ã°å·ã€å‰å¾€ã€‚", tags: ["ç¥ç¤¾"] },
            { time: "15:30", title: "åšå¤šæ¹¯ (äºŒæ—¥å¸‚)", type: "æº«æ³‰", price: "Â¥550", address: "äºŒæ—¥å¸‚æ¸©æ³‰ åšå¤šæ¹¯", note: "1300å¹´æ­·å²å¤æ¹¯ï¼Œç´”å¤©ç„¶æº«æ³‰æ”¾é¬† (éœ€è‡ªå‚™æ¯›å·¾)ã€‚", tags: ["æº«æ³‰"] },
            { time: "19:00", title: "åšå¤šä¹ã¡ã‚ƒã‚“æ‹‰éºµ", type: "ç¾é£Ÿ", price: "Â¥1,200", address: "åšå¤šé§…æ±3ä¸ç›®11-17", note: "å›é…’åº—é™„è¿‘åƒï¼Œæ¿ƒéƒè±šéª¨æ¹¯é ­ã€‚", tags: ["æ‹‰éºµ"] }
        ],
        "shopping": ["ç·£çµå¾¡å®ˆ", "æ¢…æé¤…"],
        "inspiration": [
            { title: "ä¹å·åœ‹ç«‹åšç‰©é¤¨", tag: "BACKUP", note: "é›¨å¤©å¿…å»ï¼šå°±åœ¨å¤ªå®°åºœæ—ï¼Œå»ºç¯‰å£¯è§€ï¼Œå±•è¦½è±å¯Œï¼Œå®Œå…¨å®¤å…§ã€‚", address: "å¤ªå®°åºœ", type: "åšç‰©é¤¨" },
            { title: "èŒ¶å’Œã€… æŠ¹èŒ¶", tag: "FOOD", note: "å¤ªå®°åºœåƒé“ä¸Šçš„è¶…æ¿ƒæŠ¹èŒ¶éœœæ·‡æ·‹ã€‚", address: "å¤ªå®°åºœ", type: "ç”œé»" }
        ]
    },
    "day4": { 
        "events": [
            { time: "07:30", title: "ç‰›èˆŒæ—©é¤ ãŸã‚“ã‚„", type: "æ—©é¤", price: "Â¥900", address: "JRåšå¤šåŸ B1F", note: "åšå¤šä¸€ç•ªè¡—å¿…åƒæ—©é¤ï¼Œç‚­çƒ¤è–„åˆ‡ç‰›èˆŒã€‚", tags: ["æ’éšŠååº—"] },
            { time: "10:30", title: "éº’éºŸå•¤é…’å·¥å» è¦‹å­¸", type: "é«”é©—", price: "Â¥2,500", address: "ã‚­ãƒªãƒ³ãƒ“ãƒ¼ãƒ«ç¦å²¡å·¥å ´", note: "ç”˜æœ¨éµé“ã€Œå¤ªåˆ€æ´—ç«™ã€ä¸‹è»Šã€‚å°è¦½èˆ‡è©¦é£²ï¼Œåˆé¤åƒçƒ¤è‚‰ã€‚", tags: ["å•¤é…’"] },
            { time: "15:30", title: "æ¨‚æ°´åœ’ (åº­åœ’æŠ¹èŒ¶)", type: "é«”é©—", price: "Â¥500", address: "åšå¤šåŒºä½å‰2-10-7", note: "åšå¤šå•†äººçš„åˆ¥å¢…éºè·¡ã€‚åœ¨èŒ¶å®¤é«”é©—æŠ¹èŒ¶å¥—é¤ï¼Œçœ‹åº­åœ’ç™¼å‘†ã€‚", tags: ["æŠ¹èŒ¶", "ç™‚ç™’"] },
            { time: "16:45", title: "ä½å‰ç¥ç¤¾", type: "æ™¯é»", address: "åšå¤šåŒºä½å‰3-1-51", note: "æ¨‚æ°´åœ’éš”å£ï¼Œå®ˆè­·èˆªæµ·å®‰å…¨ï¼Œèƒ½é‡å ´å¼·ã€‚", tags: ["ç¥ç¤¾"] },
            { time: "18:30", title: "åšå¤šæ°´ç‚Šã æ¿±ç”°å±‹", type: "ç¾é£Ÿ", price: "Â¥4,000", address: "JRåšå¤š City 10F", note: "ç¦å²¡ä¸‰å¤§é‹ç‰©ä¹‹ä¸€æ°´ç‚Šé‹ï¼Œè† åŸè›‹ç™½æ»¿æ»¿ã€‚", tags: ["æ°´ç‚Šé‹"] }
        ],
        "shopping": ["éº’éºŸå•¤é…’æ¯"],
        "inspiration": [
            { title: "ä½å‰ç¥ç¤¾å¤ç‰©å¸‚", tag: "BACKUP", note: "è‹¥é‡ä¸Šæ—¥æœŸï¼Œä½å‰ç¥ç¤¾å¶çˆ¾æœ‰å¤ç‰©å¸‚é›†ã€‚", address: "ä½å‰ç¥ç¤¾", type: "å¸‚é›†" },
            { title: "Rec Coffee", tag: "COFFEE", note: "ç¦å²¡çŸ¥åå† è»å’–å•¡ï¼Œåšå¤šä¸¸äº•ç™¾è²¨è£¡æœ‰åˆ†åº—ï¼Œé©åˆçœ‹æ›¸ã€‚", address: "KITTEåšå¤š", type: "å’–å•¡" }
        ]
    },
    "day5": { 
        "events": [
            { time: "08:00", title: "Sonic ç‰¹æ€¥å¾€åˆ¥åºœ", type: "äº¤é€š", price: "Â¥4,000", address: "JR åšå¤šé§…", note: "æ­ä¹˜è—è‰²ç‰¹æ€¥ Sonicï¼Œè»Šç¨‹2å°æ™‚ã€‚", tags: ["éµé“"] },
            { time: "10:30", title: "å¤§åˆ†é¦™æ°›åšç‰©é¤¨", type: "é«”é©—", price: "Â¥3,500", address: "åˆ¥åºœå¸‚åŒ—çŸ³å£48-1", note: "èª¿è£½å°ˆå±¬é¦™æ°´é«”é©—ã€‚åˆ¥åºœå¤§å­¸ä¸‹ç«™ã€‚", tags: ["é¦™æ°›"] },
            { time: "13:00", title: "Beppu Brewery", type: "ç¾é£Ÿ", price: "Â¥2,000", address: "åˆ¥åºœé§…å‰ç”º13-8", note: "è‡ªå®¶é‡€é€ ç²¾é‡€å•¤é…’ + ç‚¸é›å¤©å©¦ç¾…ã€‚", tags: ["å•¤é…’"] },
            { time: "15:00", title: "å…«å¹¡æœè¦‹ç¥ç¤¾", type: "æ™¯é»", address: "åˆ¥åºœå¸‚æœè¦‹2-15-19", note: "åˆ¥åºœæœ€å¼·èƒ½é‡é»ã€‚å¿…æ‰¾ã€Œç›ƒçŸ³ã€èˆ‡ã€Œå¤«å©¦æ‰ã€ã€‚", tags: ["ç¥ç¤¾"] },
            { time: "19:30", title: "åšå¤šä¸€åŒ æ‹‰éºµ", type: "ç¾é£Ÿ", price: "Â¥1,000", address: "åšå¤šé§…æ±3-1-6", note: "å›åšå¤šåƒè‘—åçš„ã€Œæ³¡æ²«ç³»ã€è±šéª¨æ‹‰éºµã€‚", tags: ["æ‹‰éºµ"] }
        ],
        "shopping": ["åˆ¥åºœé¦™æ°´", "åœ°ç„è’¸å¸ƒä¸"],
        "inspiration": [
            { title: "åˆ¥åºœè»Šç«™æ‰‹æ¹¯", tag: "RELAX", note: "å¦‚æœä¸æƒ³èµ°é ï¼Œè»Šç«™å‰å°±æœ‰æ‰‹æ¹¯å¯ä»¥æš–æ‰‹ã€‚", address: "åˆ¥åºœé§…", type: "æº«æ³‰" },
            { title: "å¤§æ¿ å…¬åœ’", tag: "BACKUP", note: "å¦‚æœä¸æƒ³å»åˆ¥åºœï¼Œç•™åœ¨åšå¤šå»å¤§æ¿ å…¬åœ’æ•£æ­¥çœ‹ç¾è¡“é¤¨ã€‚", address: "å¤§æ¿ å…¬åœ’", type: "æ™¯é»" }
        ]
    },
    "day6": { 
        "events": [
            { time: "10:00", title: "æ‰‹ä½œæ˜å¤ªå­é«”é©—", type: "é«”é©—", price: "Â¥2,200", address: "ãƒã‚¯ãƒã‚¯ (Haku Haku)", note: "å‰å¡šç«™å°èˆªæ­¥è¡Œ13åˆ†ã€‚è£½ä½œç¨ä¸€ç„¡äºŒçš„æ˜å¤ªå­ã€‚", tags: ["æ˜å¤ªå­"] },
            { time: "11:15", title: "ä¸­æ´²å·ç«¯ & ç·šé¦™", type: "è³¼ç‰©", address: "ä¸­æ´²å·ç«¯å•†åº—è¡—", note: "é€›å•†åº—è¡—ï¼Œå»ã€Œå¸‚å·é¦™èˆ–ã€è²·ç·šé¦™ã€‚", tags: ["è³¼ç‰©"] },
            { time: "12:30", title: "ç‡’è‚‰ BAKURO", type: "ç¾é£Ÿ", price: "Â¥3,000", address: "ä¸­å¤®åŒºå¤§å", note: "èµ¤å‚ç«™ä¸‹è»Šã€‚åˆé–“å’Œç‰›å¥—é¤ã€‚", tags: ["å’Œç‰›"] },
            { time: "14:30", title: "MY ONLY FRAGRANCE", type: "é«”é©—", price: "Â¥5,000", address: "å¤§å1-1-35", note: "è‡ªè£½å°ˆå±¬é¦™æ°´ (å·²é ç´„)ã€‚", tags: ["é¦™æ°›"] },
            { time: "16:00", title: "Dry Head Spa", type: "ç™‚ç™’", price: "Â¥4,000", address: "å¤§åå€åŸŸ", note: "é ­éƒ¨æŒ‰æ‘©æ¶ˆé™¤è…¦ç–²å‹ï¼Œä¸éœ€å¼„æ¿•é ­é«®ã€‚", tags: ["æŒ‰æ‘©"] },
            { time: "19:30", title: "èƒ¡éº»é¯–é­š & ç‰›è…¸é‹", type: "ç¾é£Ÿ", price: "Â¥4,000", address: "ä¸€åˆ© åšå¤šæœ¬åº—", note: "åšå¤šåç‰©èƒ¡éº»é¯–é­šã€‚", tags: ["ç¾é£Ÿ"] }
        ],
        "shopping": ["ç·šé¦™", "æ˜å¤ªå­", "è‡ªè£½é¦™æ°´"],
        "inspiration": [
            { title: "eel Books", tag: "BACKUP", note: "åšå¤šé™„è¿‘çš„ç¨ç«‹æ›¸åº—/å¤æ›¸é¸ç‰©åº—ï¼Œé©åˆå®‰éœç¿»æ›¸ã€‚", address: "å†·æ³‰ç”º", type: "æ›¸åº—" },
            { title: "LOFT å¤©ç¥", tag: "SHOP", note: "å¦‚æœä¸åšé¦™æ°´ï¼Œå»LOFTè²·æ–‡å…·å’Œå…¥æµ´åŠ‘ã€‚", address: "å¤©ç¥", type: "è³¼ç‰©" }
        ]
    },
    "day7": { 
        "events": [
            { time: "09:00", title: "Check-out", type: "é€€æˆ¿", note: "è¡Œæå¯„æ”¾é…’åº—æ«ƒæª¯ã€‚", tags: ["é€€æˆ¿"] },
            { time: "11:00", title: "åšå¤šç™¾å¹´è”µ", type: "æ™¯é»", address: "åšå¤šåŒºå …ç²•1-30-1", note: "æ­è¨ˆç¨‹è»Šå‰å¾€ã€‚åƒè§€150å¹´æ­·å²é…’é€ ï¼Œè²·æ¸…é…’ä¼´æ‰‹ç¦®ã€‚", tags: ["é…’é€ "] },
            { time: "12:15", title: "é®¨å‰²çƒ¹ã‚„ã¾ä¸­", type: "ç¾é£Ÿ", price: "Â¥5,000", address: "JRåšå¤š City 9F", note: "é ‚ç´šå£½å¸åˆé¤ï¼Œå®Œç¾çš„å¥é»ã€‚", tags: ["å£½å¸"] },
            { time: "14:00", title: "å‰å¾€æ©Ÿå ´", type: "äº¤é€š", price: "Bus Â¥310", address: "åšå¤šå·´å£«ç¸½ç«™ 11è™Ÿæœˆå°", note: "14:00å‰å‹™å¿…ä¸Šè»Šï¼æ­åœ‹éš›ç·šç›´é”å·´å£«ã€‚", tags: ["æ©Ÿå ´", "å¿…è®€"] }
        ],
        "shopping": ["ç™¾å¹´è”µæ¸…é…’", "åšå¤šé€šé¥…é ­", "Menbei"],
        "inspiration": [
            { title: "é˜ªæ€¥ç™¾è²¨åœ°ä¸‹è¡—", tag: "BACKUP", note: "æœ€å¾Œè¡åˆºï¼è²·ä¼´æ‰‹ç¦®æœ€é½Šå…¨çš„åœ°æ–¹ï¼Œä¸ç”¨è·‘ä¾†è·‘å»ã€‚", address: "åšå¤šé˜ªæ€¥", type: "è³¼ç‰©" },
            { title: "æ©Ÿå ´è²´è³“å®¤", tag: "RELAX", note: "æ—©é»å»æ©Ÿå ´ï¼Œåœ¨Loungeå–æ¯é…’ä¼‘æ¯ã€‚", address: "ç¦å²¡æ©Ÿå ´", type: "ä¼‘æ¯" }
        ]
    }
};
</script>

<div id="toast"><i class="fa-solid fa-circle-check"></i> <span id="toast-msg">Action Completed</span></div>
<header>
    <div>
        <h1 id="app-title">TRIP PLANNER</h1>
        <div id="local-clock">--:--</div>
    </div>
    <div class="header-actions">
        <div class="header-btn" onclick="openTools()"><i class="fa-solid fa-suitcase"></i></div>
        <div class="header-btn" onclick="toggleSidebar()"><i class="fa-solid fa-bars"></i></div>
    </div>
</header>

<div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>
<div class="sidebar" id="sidebar">
    <div style="font-size:0.8rem; color:#aaa; margin-bottom:10px; font-weight:700; letter-spacing:1px;">SAFETY & TOOLS</div>
    <div class="tool-box" style="background: #25D366; border:none; color:#fff; text-align:center; cursor:pointer;" onclick="sendWhatsApp()">
        <i class="fa-brands fa-whatsapp" style="font-size:2rem; margin-bottom:5px;"></i>
        <div style="font-weight:bold;">å ±å¹³å®‰ (Send Location)</div>
    </div>
    <div class="tool-box">
        <div style="margin-bottom:10px; font-weight:bold; color:#fff;">åŒ¯ç‡æ›ç®— (Rate: 0.052)</div>
        <input type="number" id="curr-jpy" class="curr-input" placeholder="JPY Â¥" oninput="convertCurrency()">
        <div style="text-align:center; color:var(--accent); margin:5px;">â‡…</div>
        <input type="number" id="curr-hkd" class="curr-input" placeholder="HKD $" readonly>
    </div>
    <div class="tool-box">
        <div style="margin-bottom:10px; font-weight:bold; color:#fff;">æ‰‹æŒ‡æ—¥èª</div>
        <div class="shop-item" onclick="showPhrase('ä¸€äººã§ã™', 'æˆ‘æ˜¯ä¸€ä½')"><label>ä¸€ä½ (Hit-ori)</label></div>
        <div class="shop-item" onclick="showPhrase('ãŠä¼šè¨ˆãŠé¡˜ã„ã—ã¾ã™', 'éº»ç…©çµå¸³')"><label>çµå¸³ (Kaikei)</label></div>
        <div class="shop-item" onclick="showPhrase('ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹', 'å»æ‰€åœ¨å“ªè£¡')"><label>å»æ‰€ (Toire)</label></div>
        <div class="shop-item" onclick="showPhrase('ã“ã‚Œã¯ä½•ã§ã™ã‹', 'é€™æ˜¯ä»€éº¼')"><label>é€™æ˜¯ä»€éº¼ (Kore wa?)</label></div>
    </div>
</div>

<div id="phrase-overlay" class="phrase-overlay" onclick="closePhrase()">
    <div id="overlay-jp" class="phrase-big"></div>
    <div id="overlay-zh" class="phrase-sub"></div>
    <button class="close-phrase">é—œé–‰</button>
</div>

<div class="date-selector-container"><div class="date-selector" id="date-selector"></div></div>

<main>
    <div id="page-itinerary" class="page active"><div class="timeline-container" id="timeline-container"></div></div>
    
    <div id="page-inspiration" class="page">
        <div class="filter-bar-container">
            <span class="filter-chip active" onclick="filterInspiration('all', this)">å…¨éƒ¨</span>
            <span class="filter-chip" onclick="filterInspiration('BACKUP', this)">â˜” å‚™æ¡ˆ</span>
            <span class="filter-chip" onclick="filterInspiration('RELAX', this)">â˜• ä¼‘æ¯</span>
            <span class="filter-chip" onclick="filterInspiration('SHOP', this)">ğŸ›ï¸ é€›è¡—</span>
        </div>
        <div id="inspiration-container" style="padding: 0 15px;"></div>
    </div>

    <div id="page-shopping" class="page">
        <div class="page-header"><h2 class="page-title">è³¼ç‰©æ¸…å–®</h2></div>
        <div id="shopping-container" class="shopping-list"></div>
    </div>

    <div id="page-weather" class="page">
        <div id="weather-content"><div style="text-align:center; padding:50px; color:#fff;"><i class="fa-solid fa-spinner fa-spin"></i> è¼‰å…¥ç¦å²¡å¤©æ°£...</div></div>
        <div id="weather-details-container" style="display:none;">
            <span class="section-label">ä»Šæ—¥æ™‚æ®µ (3H)</span>
            <div class="hourly-container" id="weather-hourly"></div>
            <span class="section-label" style="margin-top:20px;">æ—…äººå»ºè­°</span>
            <div class="advice-card">
                <div class="advice-icon"><i class="fa-solid fa-shirt"></i></div>
                <div class="advice-content"><h4>ç©¿æ­æŒ‡å—</h4><p id="weather-advice-text">è¼‰å…¥ä¸­...</p></div>
            </div>
            <div class="weather-grid">
                <div class="weather-stat-card"><div class="ws-row"><span class="ws-label">æ¿•åº¦</span><i class="fa-solid fa-droplet ws-icon"></i></div><div class="ws-value" id="ws-humidity">--%</div></div>
                <div class="weather-stat-card"><div class="ws-row"><span class="ws-label">æ—¥è½</span><i class="fa-solid fa-moon ws-icon"></i></div><div class="ws-value" id="ws-sunset">--:--</div></div>
            </div>
        </div>
    </div>

    <div id="page-info" class="page">
        <div class="page-header"><h2 class="page-title">æ—…ç¨‹è³‡è¨Š</h2></div>
        <div id="dynamic-info-content"></div>
    </div>
</main>

<nav class="bottom-nav">
    <div class="nav-item active" onclick="switchMainPage('itinerary', this)"><i class="fa-solid fa-list-ul"></i><span>è¡Œç¨‹</span></div>
    <div class="nav-item" onclick="switchMainPage('inspiration', this)"><i class="fa-regular fa-lightbulb"></i><span>éˆæ„Ÿ</span></div>
    <div class="nav-item" onclick="switchMainPage('shopping', this)"><i class="fa-solid fa-bag-shopping"></i><span>æ¡è²·</span></div>
    <div class="nav-item" onclick="switchMainPage('weather', this)"><i class="fa-solid fa-cloud-sun"></i><span>å¤©æ°£</span></div>
    <div class="nav-item" onclick="switchMainPage('info', this)"><i class="fa-solid fa-passport"></i><span>è³‡è¨Š</span></div>
</nav>

<div id="detail-modal" class="modal">
    <div class="modal-content">
        <div class="modal-handle-container" id="modal-drag-area"><div class="modal-handle"></div></div>
        <div id="modal-mini-map" style="height:150px; background:#eee;"></div>
        <div class="modal-body">
            <div style="margin-top:15px; margin-bottom:5px;"><span class="modal-label" id="modal-type">Type</span><h2 id="modal-title" style="margin:0; font-size:1.4rem; font-family:var(--font-heading); font-weight:700;">Title</h2></div>
            <div class="modal-info-grid">
                <div class="modal-row"><i class="fa-regular fa-clock modal-icon"></i><span id="modal-time" style="font-weight:600;"></span></div>
                <div class="modal-row"><i class="fa-solid fa-yen-sign modal-icon"></i><span id="modal-price"></span></div>
                <div class="modal-row"><i class="fa-solid fa-location-dot modal-icon"></i><span id="modal-address-short" style="font-size:0.9rem;"></span></div>
            </div>
            <div class="modal-label">å‚™è¨»</div>
            <div class="modal-note-box"><div id="modal-note"></div></div>
            <div id="modal-actions"></div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// --- [System Logic] ---
function applyTheme() {
    // Theme is handled by CSS :root, no JS needed for this version
}

const scheduleData = generateScheduleData();
let currentDay = "day1";
let modalMap = null;
let exchangeRate = 0.052; 
let weatherCache = null;
let shopState = JSON.parse(localStorage.getItem('shopState')) || {};

function generateScheduleData() {
    const days = {};
    const base = new Date(CONFIG.startDate);
    const weekDays = ["é€±æ—¥", "é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››", "é€±äº”", "é€±å…­"];
    for(let i=0; i<CONFIG.duration; i++) {
        const d = new Date(base); d.setDate(base.getDate() + i);
        const k = `day${i+1}`;
        const data = USER_ITINERARY[k];
        days[k] = {
            date: `${d.getMonth()+1}/${d.getDate()}`, 
            weekday: weekDays[d.getDay()],
            events: data ? data.events : [],
            inspiration: data ? data.inspiration : [],
            shopping: data ? data.shopping : []
        };
    }
    return days;
}

function init() {
    document.getElementById('app-title').innerHTML = DESTINATION.appTitle;
    renderDateSelector();
    selectDay('day1'); 
    renderInfoPage();
    updateLocalClock();
    setInterval(updateLocalClock, 1000);
    initSwipeClose();
}

function updateLocalClock() {
    const options = { timeZone: DESTINATION.timezone, hour: '2-digit', minute: '2-digit', hour12: false };
    const timeString = new Date().toLocaleTimeString('en-US', options);
    document.getElementById('local-clock').innerText = `FUKUOKA ${timeString}`;
}

function renderDateSelector() {
    const container = document.getElementById('date-selector');
    container.innerHTML = '';
    Object.keys(scheduleData).forEach(dayKey => {
        const day = scheduleData[dayKey];
        const dNum = dayKey.replace('day', '');
        const chip = document.createElement('div');
        chip.className = `date-chip`;
        chip.id = `chip-${dayKey}`;
        chip.onclick = () => selectDay(dayKey, chip);
        chip.innerHTML = `<span class="day-num">D${dNum}</span><span class="day-week">${day.date}</span>`;
        container.appendChild(chip);
    });
}

function selectDay(dayKey, chipEl) {
    currentDay = dayKey;
    document.querySelectorAll('.date-chip').forEach(c => c.classList.remove('active'));
    (chipEl || document.getElementById(`chip-${dayKey}`)).classList.add('active');
    
    renderTimeline(dayKey);
    renderInspiration(dayKey);
    renderShopping(dayKey);
    if(document.getElementById('page-weather').classList.contains('active')) fetchWeather();
}

function renderTimeline(dayKey) {
    const container = document.getElementById('timeline-container');
    container.innerHTML = '';
    const day = scheduleData[dayKey];
    if(!day.events.length) { container.innerHTML = "<div style='text-align:center; padding:50px; color:#aaa;'>æœ¬æ—¥è‡ªç”±æ´»å‹•</div>"; return; }
    
    day.events.forEach(event => {
        const item = document.createElement('div');
        item.className = 'timeline-item';
        let tags = (event.tags || []).map(t => `<span class="card-tag ${t==='å¿…è®€'||t==='æ©Ÿå ´'?'alert':''}">${t}</span>`).join('');
        const navBtn = `<div class="card-nav-btn" onclick="event.stopPropagation(); openMapQuery('${event.address}')"><i class="fa-solid fa-location-arrow"></i></div>`;
        const colorStyle = event.moodColor ? `border-left-color: ${event.moodColor};` : 'border-left-color: var(--accent);';
        
        item.innerHTML = `<div class="card" style="${colorStyle}" onclick='openModal(${JSON.stringify(event).replace(/'/g, "&#39;")})'>${navBtn}<span class="card-time">${event.time}</span><div class="card-title">${event.title}</div><div class="tags">${tags}</div></div>`;
        container.appendChild(item);
    });
}

function renderInspiration(dayKey) {
    const container = document.getElementById('inspiration-container');
    container.innerHTML = '';
    const items = scheduleData[dayKey].inspiration || [];
    items.forEach(item => {
        const isBackup = item.tag === 'BACKUP';
        const badgeClass = isBackup ? 'inspire-badge backup' : 'inspire-badge';
        container.innerHTML += `<div class="inspire-card" data-tag="${item.tag}">
            <div class="${badgeClass}">${item.tag}</div>
            <h3 class="inspire-title">${item.title}</h3>
            <p class="inspire-note">${item.note}</p>
        </div>`;
    });
}

function renderShopping(dayKey) {
    const container = document.getElementById('shopping-container');
    container.innerHTML = '';
    const items = scheduleData[dayKey].shopping || [];
    if(items.length === 0) { container.innerHTML = "<div style='color:#666; text-align:center; padding:20px;'>ç„¡å¾…è²·æ¸…å–®</div>"; return; }
    items.forEach((item, idx) => {
        const uniqueId = `${dayKey}-${idx}`;
        const isChecked = shopState[uniqueId] ? 'checked' : '';
        container.innerHTML += `<div class="shop-item ${isChecked}"><input type="checkbox" id="${uniqueId}" ${isChecked} onchange="toggleShopItem(this, '${uniqueId}')"><label for="${uniqueId}">${item}</label></div>`;
    });
}
function toggleShopItem(checkbox, id) { shopState[id] = checkbox.checked; localStorage.setItem('shopState', JSON.stringify(shopState)); checkbox.closest('.shop-item').classList.toggle('checked'); }

function switchMainPage(pageId, navEl) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById('page-' + pageId).classList.add('active');
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    if(navEl) navEl.classList.add('active');
    
    if(pageId === 'weather') fetchWeather();
}

// Weather
async function fetchWeather() {
    const container = document.getElementById('weather-content');
    const details = document.getElementById('weather-details-container');
    // Using Fukuoka coords
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${DESTINATION.lat}&longitude=${DESTINATION.lon}&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_probability_max,sunrise,sunset&hourly=temperature_2m,relative_humidity_2m&timezone=${encodeURIComponent(DESTINATION.timezone)}&forecast_days=1`;
    
    try {
        const res = await fetch(url);
        const data = await res.json();
        const d = data.daily;
        
        container.innerHTML = `<div class="weather-main-card">
            <div class="weather-tag-badge">å³æ™‚é å ±</div>
            <div class="weather-header-row">
                <div><div class="weather-condition">Fukuoka</div><div class="weather-hl">H:${d.temperature_2m_max[0]}Â° L:${d.temperature_2m_min[0]}Â°</div></div>
                <div class="weather-main-icon"><i class="fa-solid fa-cloud-sun"></i></div>
            </div>
            <div class="weather-big-temp">${Math.round(data.hourly.temperature_2m[12])}Â°</div>
            <div>é™é›¨æ©Ÿç‡ ${d.precipitation_probability_max[0]}%</div>
        </div>`;
        
        // Advice
        let advice = "æµ·é¢¨å¼·å‹ï¼Œè«‹æ³¨æ„ä¿æš–ã€‚";
        if(d.precipitation_probability_max[0] > 40) advice = "é™é›¨æ©Ÿç‡é«˜ï¼Œè«‹æ”œå¸¶é›¨å…·ï¼Œä¸¦è€ƒæ…®ä½¿ç”¨ã€Œéˆæ„Ÿã€ä¸­çš„é›¨å¤©å‚™æ¡ˆã€‚";
        document.getElementById('weather-advice-text').innerText = advice;
        
        document.getElementById('ws-humidity').innerText = data.hourly.relative_humidity_2m[12] + '%';
        document.getElementById('ws-sunset').innerText = d.sunset[0].split('T')[1];
        
        details.style.display = 'block';
    } catch(e) { console.error(e); }
}

function openModal(data) {
    document.getElementById('modal-title').innerText = data.title;
    document.getElementById('modal-type').innerText = data.type || "INFO";
    document.getElementById('modal-time').innerText = data.time;
    document.getElementById('modal-price').innerText = data.price || "-";
    document.getElementById('modal-address-short').innerText = data.address;
    document.getElementById('modal-note').innerHTML = data.note;
    
    const actions = document.getElementById('modal-actions');
    actions.innerHTML = '';
    actions.innerHTML += `<button class="btn-action btn-black" onclick="openMapQuery('${data.address}')"><i class="fa-solid fa-location-arrow"></i> Google Maps</button>`;
    
    const jpAddr = data.address_jp || data.title_jp || data.address;
    actions.innerHTML += `<button class="btn-action btn-outline" onclick="showPhrase('${jpAddr}', 'è«‹è¼‰æˆ‘å»é€™è£¡')"><i class="fa-solid fa-taxi"></i> çµ¦å¸æ©Ÿçœ‹ (Show Taxi)</button>`;
    
    document.getElementById('detail-modal').classList.add('open');
    
    setTimeout(() => { 
        if(modalMap) modalMap.remove(); 
        const coords = data.coords || [DESTINATION.lat, DESTINATION.lon];
        modalMap = L.map('modal-mini-map', {zoomControl:false, dragging:false, attributionControl:false}).setView(coords, 15);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(modalMap);
        L.marker(coords).addTo(modalMap);
    }, 150);
}
function closeModal() { document.getElementById('detail-modal').classList.remove('open'); }
function initSwipeClose() {
    const modalContent = document.querySelector('.modal-content');
    const dragArea = document.getElementById('modal-drag-area');
    let startY = 0;
    dragArea.addEventListener('touchstart', (e) => { startY = e.touches[0].clientY; modalContent.style.transition = 'none'; });
    dragArea.addEventListener('touchmove', (e) => { const delta = e.touches[0].clientY - startY; if(delta > 0) modalContent.style.transform = `translateY(${delta}px)`; });
    dragArea.addEventListener('touchend', (e) => { const delta = e.changedTouches[0].clientY - startY; modalContent.style.transition = 'transform 0.3s ease-out'; if(delta > 100) closeModal(); else modalContent.style.transform = ''; });
}

function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); document.getElementById('sidebar-overlay').classList.toggle('open'); }
function openTools() { toggleSidebar(); } // Alias
function convertCurrency() { document.getElementById('curr-hkd').value = (document.getElementById('curr-jpy').value * exchangeRate).toFixed(1); }
function showPhrase(jp, zh) { document.getElementById('overlay-jp').innerText = jp; document.getElementById('overlay-zh').innerText = zh; document.getElementById('phrase-overlay').classList.add('active'); }
function closePhrase() { document.getElementById('phrase-overlay').classList.remove('active'); }
function sendWhatsApp() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
            const link = `http://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;
            window.location.href = `https://wa.me/?text=${encodeURIComponent("I am here: " + link)}`;
        });
    } else alert("No GPS");
}
function openMapQuery(q) { window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(q)}`, '_blank'); }

function renderInfoPage() {
    const c = document.getElementById('dynamic-info-content');
    let html = `<div class="info-card"><div class="info-header">èˆªç­ (Flights)</div>`;
    TRIP_INFO.flights.forEach(f => {
        html += `<div class="flight-row"><div class="flight-code"><i class="fa-solid fa-plane"></i> ${f.flight}</div><div class="flight-time">${f.dep} â” ${f.arr}</div><div style="font-size:0.8rem; color:#aaa; margin-top:5px;">${f.note}</div></div>`;
    });
    html += `</div>`;
    
    html += `<div class="info-card"><div class="info-header">ä½å®¿ (Hotel)</div>`;
    TRIP_INFO.hotels.forEach(h => {
        html += `<div class="info-row"><div class="info-icon"><i class="fa-solid fa-hotel"></i></div><div><div style="font-weight:bold; color:#fff;">${h.name}</div><div style="font-size:0.85rem; color:#aaa; margin-top:5px;">${h.address}</div></div></div>`;
    });
    html += `</div>`;
    
    html += `<div class="info-card"><div class="info-header">ç·Šæ€¥è¯çµ¡ (Emergency)</div>`;
    TRIP_INFO.emergency.forEach(e => {
        html += `<div class="info-row" onclick="window.location.href='tel:${e.phone}'"><div class="info-icon"><i class="fa-solid fa-phone-volume"></i></div><div>${e.name} <span style="color:var(--accent); font-weight:bold; margin-left:10px;">${e.phone}</span></div></div>`;
    });
    html += `</div>`;
    c.innerHTML = html;
}

function filterInspiration(tag, btn) {
    document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.inspire-card').forEach(card => {
        if(tag === 'all' || card.getAttribute('data-tag') === tag) card.classList.remove('hidden'); else card.classList.add('hidden');
    });
}

init();
</script>
</body>
</html>
