<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="theme-color" content="#F9F9F9">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<title>Loading...</title>
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon.png">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<style>
/* ========================================================
ğŸ¨ [ç³»çµ±æ¨£å¼è¡¨]Â 
========================================================
*/
:root {
--bg-body: #FFFFFF; --bg-card: #F9F9F9;
--text-main: #111111; --text-sub: #777777;
--accent: #000000; --accent-text: #FFFFFF;
--border: #EEEEEE;
--font-heading: sans-serif; --font-body: sans-serif;
--shadow: 0 1px 3px rgba(0,0,0,0.05);
--safe-top: env(safe-area-inset-top);
--safe-bottom: env(safe-area-inset-bottom);
}
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
body { font-family: var(--font-body); background-color: var(--bg-body); color: var(--text-main); margin: 0; padding: 0; height: 100dvh; display: flex; flex-direction: column; overflow: hidden; transition: all 0.3s ease; line-height: 1.4; }

/* Header */
header { background-color: var(--bg-card); opacity: 0.98; backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); padding: 0 15px; padding-top: var(--safe-top); height: calc(56px + var(--safe-top)); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; position: relative; z-index: 200; }
header h1 { margin: 0; font-size: 1.1rem; font-weight: 800; letter-spacing: 0.5px; color: var(--text-main); font-family: var(--font-heading); text-transform: uppercase; line-height: 1; }
#home-clock { font-size: 0.65rem; color: var(--text-sub); font-weight: 600; letter-spacing: 1px; margin-top: 3px; font-variant-numeric: tabular-nums; }
.header-actions { display: flex; align-items: center; gap: 8px; }
.header-btn { font-size: 1rem; cursor: pointer; color: var(--text-main); border-radius: 50%; width: 36px; height: 36px; display: flex; justify-content: center; align-items: center; background: transparent; transition: background 0.2s; }

/* Date Selector */
.date-selector-container { background: var(--bg-card); opacity: 0.98; padding: 5px 0; border-bottom: 1px solid var(--border); width: 100%; flex-shrink: 0; position: relative; z-index: 90; }
.date-selector { display: flex; gap: 5px; overflow-x: auto; scrollbar-width: none; padding: 0 10px; }
.date-chip { flex: 1 0 auto; min-width: 55px; max-width: 100px; padding: 8px 0; border-radius: 0; cursor: pointer; color: var(--text-sub); display: flex; flex-direction: column; align-items: center; justify-content: center; background: transparent; border: 1px solid transparent; transition: all 0.2s; }
.date-chip.active { background: var(--accent); color: var(--accent-text); border-color: var(--accent); }
.day-num { font-weight: 700; font-size: 1rem; line-height: 1; margin-bottom: 2px; font-family: var(--font-heading); }
.day-week { font-size: 0.6rem; font-weight: 500; opacity: 0.8; letter-spacing: 0.5px; text-transform: uppercase;}

/* Main Structure */
main { flex: 1; overflow-y: hidden; position: relative; }
.page { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow-y: auto; padding: 10px 0 80px 0; display: none; opacity: 0; transition: opacity 0.2s ease; background-color: var(--bg-body); -webkit-overflow-scrolling: touch; }
.page.active { display: block; opacity: 1; z-index: 10; }
.page-header { padding: 0 15px; margin-bottom: 15px; }
.page-title { font-size: 1.5rem; font-weight: 800; margin: 0; letter-spacing: -0.5px; font-family: var(--font-heading); }

/* Timeline */
.timeline-container { padding: 5px 15px; max-width: 800px; margin: 0 auto; }
.timeline-item { position: relative; padding-left: 25px; padding-bottom: 12px; border-left: 1px solid var(--border); }
.timeline-item:last-child { border-left: 1px solid transparent; }
.timeline-item::before { content: ''; position: absolute; left: -3px; top: 18px; width: 5px; height: 5px; background: var(--text-main); border-radius: 50%; z-index: 2; }
.card { background-color: var(--bg-card); border-radius: 0; padding: 15px; padding-right: 50px; box-shadow: var(--shadow); cursor: pointer; position: relative; transition: transform 0.1s; border: 1px solid var(--border); min-height: auto; display: flex; flex-direction: column; justify-content: center; border-left-width: 4px; }
.card:active { transform: scale(0.99); opacity: 0.9; }
.card-nav-btn { position: absolute; top: 50%; right: 15px; transform: translateY(-50%); width: 32px; height: 32px; border-radius: 50%; background: var(--bg-body); color: var(--text-main); display: flex; justify-content: center; align-items: center; font-size: 0.9rem; border: 1px solid var(--border); }
.card-title { font-size: 1rem; font-weight: 700; margin: 0 0 5px 0; line-height: 1.3; font-family: var(--font-heading); color: var(--text-main); letter-spacing: 0.2px; }
.card-time { font-size: 0.7rem; color: var(--text-sub); font-weight: 600; margin-bottom: 4px; display: block; font-family: var(--font-body); letter-spacing: 0.5px; text-transform: uppercase;}
.card-tag { font-size: 0.6rem; background: var(--bg-body); padding: 2px 6px; border-radius: 0; color: var(--text-sub); font-weight: 500; border: 1px solid var(--border); letter-spacing: 0.5px; }

/* Weather - Modified for Auto Layout */
.weather-main-card { background: var(--text-main); color: var(--bg-body); border-radius: 0; padding: 20px; margin: 0 15px 20px 15px; text-align: center; position: relative; overflow: hidden;}
.weather-tag-badge { position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.2); padding: 2px 8px; font-size: 0.6rem; border-radius: 10px; font-weight: 600; }
.weather-header-row { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 5px; }
.weather-big-temp { font-size: 3.5rem; font-weight: 300; line-height: 1; letter-spacing: -2px; font-family: var(--font-heading); }
.weather-condition { font-size: 0.9rem; font-weight: 600; opacity: 0.9; margin-bottom: 2px; letter-spacing: 1px; text-transform: uppercase;}
.weather-hl { font-size: 0.75rem; opacity: 0.7; font-family: var(--font-body); }
.weather-main-icon { font-size: 2.5rem; color: inherit; opacity: 0.9; }
.section-label { padding: 0 15px; font-size: 0.65rem; font-weight: 700; color: var(--text-main); margin-bottom: 10px; display: block; text-transform: uppercase; letter-spacing: 1.5px; }

/* --- ğŸ”¥ æ”¹è‰¯é‡é»ï¼šè‡ªå‹•èª¿ç¯€å¯¬åº¦çš„æ™‚æ®µé å ± --- */
.hourly-container { 
    display: flex; 
    gap: 6px; /* ç¨å¾®ç¸®å°é–“è·è®“è¦–è¦ºæ›´ç·Šæ¹Š */
    overflow-x: auto; 
    padding: 0 15px 15px 15px; 
    scrollbar-width: none; 
    /* é€™è£¡ä¸éœ€è¦ justify-content: space-betweenï¼Œäº¤çµ¦ item çš„ flex: 1 è™•ç† */
}
.hourly-item { 
    flex: 1; /* âœ¨ é—œéµï¼šè®“é …ç›®è‡ªå‹•æ“´å±•å¡«æ»¿ç©ºé–“ */
    min-width: 0; /* å…è¨±å…§å®¹åœ¨æ¥µå°è¢å¹•ç¸®å° */
    width: auto; /* å–æ¶ˆå›ºå®šå¯¬åº¦ */
    background: var(--bg-card); 
    border-radius: 0; 
    padding: 10px 2px; /* å·¦å³ padding ç¸®å°ï¼Œé¿å…åœ¨å°è¢å¹•è¢«æ“ çˆ† */
    text-align: center; 
    border: 1px solid var(--border); 
    display: flex; 
    flex-direction: column; 
    align-items: center; 
    justify-content: space-between; 
    height: 90px; 
}
/* --- æ”¹è‰¯çµæŸ --- */

.hourly-time { font-size: 0.65rem; color: var(--text-sub); font-weight: 600; margin-bottom: 5px; }
.hourly-icon { font-size: 1rem; margin: 5px 0; color: var(--text-main); }
.hourly-temp { font-size: 0.85rem; font-weight: 700; color: var(--text-main); }
.hourly-rain { font-size: 0.55rem; color: var(--text-sub); font-weight: 500; margin-top: 5px; }
.advice-card { background: var(--bg-card); margin: 0 15px 25px 15px; padding: 15px; border-radius: 0; border: 1px solid var(--border); display: flex; gap: 15px; align-items: flex-start; }
.advice-icon { width: 32px; height: 32px; background: var(--bg-body); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 0.9rem; color: var(--text-main); border: 1px solid var(--border); }
.advice-content h4 { margin: 0 0 5px 0; font-size: 0.85rem; color: var(--text-main); text-transform: uppercase; letter-spacing: 1px; font-weight: 700; }
.advice-content p { margin: 0; font-size: 0.85rem; color: var(--text-sub); line-height: 1.5; }
.weather-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin: 0 15px 30px 15px; }
.weather-stat-card { background: var(--bg-card); padding: 15px; border-radius: 0; border: 1px solid var(--border); display: flex; flex-direction: column; justify-content: center; height: 80px; }
.ws-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
.ws-label { font-size: 0.6rem; color: var(--text-sub); text-transform: uppercase; font-weight: 700; letter-spacing: 1px; }
.ws-icon { color: var(--text-sub); font-size: 0.8rem; }
.ws-value { font-size: 1.1rem; font-weight: 400; color: var(--text-main); font-family: var(--font-heading); }
.ws-sub { font-size: 0.65rem; color: var(--text-sub); margin-top: 2px; }

/* Shopping */
.shopping-list { padding: 0 15px; }
.shop-item { background: var(--bg-card); padding: 15px; border-radius: 0; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; border: 1px solid var(--border); }
.shop-item.checked { opacity: 0.4; background: var(--bg-body); }
.shop-item input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--accent); border-radius: 0; }
.shop-item label { flex: 1; font-size: 0.95rem; color: var(--text-main); font-family: var(--font-body); }

/* Inspiration */
.filter-bar-container { padding: 0 15px 15px 15px; position: sticky; top: 0; z-index: 50; background: var(--bg-body); overflow-x: auto; white-space: nowrap; scrollbar-width: none; border-bottom: 1px solid var(--border); margin-bottom: 15px; }
.filter-chip { display: inline-block; padding: 8px 16px; margin-right: 8px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 0; font-size: 0.75rem; color: var(--text-sub); cursor: pointer; transition: all 0.2s; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
.filter-chip.active { background: var(--accent); color: var(--accent-text); border-color: var(--accent); }
.inspire-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 0; padding: 20px; color: var(--text-main); position: relative; display: flex; flex-direction: column; justify-content: center; margin-bottom: 15px; cursor: pointer; min-height: 80px; box-shadow: var(--shadow); }
.inspire-card:active { transform: scale(0.99); opacity: 0.9; }
.inspire-card.hidden { display: none; }
.inspire-badge { background: var(--accent); color: var(--accent-text); padding: 3px 8px; border-radius: 0; font-size: 0.6rem; font-weight: 700; position: absolute; top: -10px; left: 15px; text-transform: uppercase; letter-spacing: 1px; }
.inspire-title { font-size: 1rem; font-weight: 700; margin: 0 0 4px 0; font-family: var(--font-heading); }
.inspire-note { font-size: 0.85rem; color: var(--text-sub); line-height: 1.4; }

/* Info Page */
.info-card { background: var(--bg-card); padding: 20px; border-radius: 0; margin: 0 15px 15px 15px; border: 1px solid var(--border); }
.info-header { font-weight: bold; margin-bottom: 12px; border-bottom: 1px solid var(--border); padding-bottom: 8px; font-family: var(--font-heading); display: flex; justify-content: space-between; align-items: center; font-size: 0.95rem; }
.info-row { display: flex; gap: 15px; margin-bottom: 15px; align-items: flex-start; font-size: 0.9rem; color: var(--text-main); line-height: 1.5; }
.info-icon { width: 18px; text-align: center; color: var(--text-sub); padding-top: 2px; flex-shrink: 0; font-size: 0.9rem; }
.contact-container { display: flex; align-items: center; gap: 8px; flex-wrap: nowrap; margin-top: 0; }
.btn-icon-sm { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; font-size: 0.85rem; cursor: pointer; transition: transform 0.1s; border: 1px solid var(--border); color: var(--text-main); background: var(--bg-body); flex-shrink: 0; }
.btn-copy-text { padding: 3px 8px; font-size: 0.7rem; border: 1px solid var(--border); background: var(--bg-body); color: var(--text-main); cursor: pointer; border-radius: 4px; white-space: nowrap; margin-left: 5px; }
.flight-grid { display: grid; grid-template-columns: 1fr; gap: 10px; }
.flight-row { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px dashed var(--border); padding-bottom: 12px; margin-bottom: 12px; }
.flight-code { font-size: 1.1rem; font-weight: 800; font-family: var(--font-heading); color: var(--text-main); display: flex; align-items: center; gap: 6px;}
.flight-time { font-size: 0.85rem; font-weight: 600; margin-top: 2px; color: var(--text-main); }
.flight-meta { font-size: 0.65rem; color: var(--text-sub); text-transform: uppercase; letter-spacing: 1px; margin-top: 3px; }

/* Phrases Grid */
.phrase-section-header { padding: 15px 15px 5px 15px; font-size: 0.8rem; font-weight: 700; color: var(--text-sub); text-transform: uppercase; letter-spacing: 1px; margin-top: 10px; }
.phrase-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 0 15px 30px 15px; }
.phrase-card { background: var(--bg-card); border: 1px solid var(--border); padding: 20px 10px; border-radius: 0; text-align: center; cursor: pointer; transition: all 0.2s; box-shadow: var(--shadow); aspect-ratio: 1.4; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; overflow: hidden; }
.phrase-card:active { transform: scale(0.97); opacity: 0.9; }
.phrase-primary { font-weight: 700; font-size: 1.1rem; margin-bottom: 6px; color: var(--text-main); font-family: var(--font-heading); }
.phrase-secondary { font-size: 0.8rem; color: var(--text-sub); }
.phrase-pronounce { font-size: 0.6rem; color: var(--text-sub); opacity: 0.6; margin-top: 4px; text-transform: uppercase; letter-spacing: 0.5px; }

/* Modal & Overlay */
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 3000; justify-content: center; align-items: end; backdrop-filter: blur(5px); cursor: pointer; }
.modal.open { display: flex; }
.modal-content { background: var(--bg-card); color: var(--text-main); width: 100%; max-width: 600px; max-height: 90vh; border-radius: 0; padding: 0 0 30px 0; overflow-y: auto; animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); cursor: default; display: flex; flex-direction: column; border-top: 1px solid var(--border); box-shadow: 0 -10px 40px rgba(0,0,0,0.05); transition: transform 0.2s ease-out; }
.modal-handle-container { width: 100%; height: 25px; display: flex; justify-content: center; align-items: center; flex-shrink: 0; touch-action: none; cursor: grab; }
.modal-handle { width: 36px; height: 4px; background: #DDDDDD; border-radius: 10px; }
.modal-body { padding: 0 25px 25px 25px; }
.modal-info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
.modal-label { font-size: 0.65rem; color: var(--text-sub); text-transform: uppercase; letter-spacing: 1.5px; display: block; margin-bottom: 6px; font-weight: 700; }
.modal-value { font-size: 0.95rem; font-weight: 400; color: var(--text-main); font-family: var(--font-body); }
.modal-note-box { background: var(--bg-body); padding: 20px; border-radius: 0; margin: 15px 0; border: 1px solid var(--border); font-size: 0.9rem; line-height: 1.7; color: var(--text-main); white-space: pre-line; }
.btn-action { width: 100%; padding: 16px; border-radius: 0; border: none; font-weight: 600; cursor: pointer; font-size: 0.85rem; text-align: center; margin-bottom:10px; text-transform: uppercase; letter-spacing: 1px; }
.btn-black { background: var(--accent); color: var(--accent-text); }
.btn-outline { background: var(--bg-card); border: 1px solid var(--text-main); color: var(--text-main); }

/* Nav & Sidebar */
nav.bottom-nav { position: fixed; bottom: 0; width: 100%; background-color: var(--bg-card); opacity: 0.98; display: flex; justify-content: space-around; padding: 12px 0 calc(12px + var(--safe-bottom)) 0; border-top: 1px solid var(--border); z-index: 100; backdrop-filter: blur(10px); }
.nav-item { color: var(--text-sub); text-align: center; font-size: 0.6rem; cursor: pointer; width: 25%; transition: color 0.2s; opacity: 0.5; }
.nav-item.active { color: var(--accent); opacity: 1; font-weight: 600; }
.nav-item i { display: block; font-size: 1.2rem; margin-bottom: 4px; }
#toast { position: fixed; top: 80px; left: 50%; transform: translateX(-50%); background: var(--text-main); color: var(--bg-card); padding: 10px 20px; border-radius: 30px; font-size: 0.85rem; z-index: 9999; opacity: 0; pointer-events: none; transition: opacity 0.3s; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); font-weight: 500; } #toast.show { opacity: 1; }
.sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.2); z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.3s; backdrop-filter: blur(2px); } .sidebar-overlay.open { opacity: 1; pointer-events: all; }
.sidebar { position: fixed; top: 0; right: 0; width: 85%; max-width: 300px; height: 100%; background: var(--bg-card); color: var(--text-main); z-index: 1001; transform: translateX(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); overflow-y: auto; padding: 25px 20px 100px 20px; padding-top: calc(25px + var(--safe-top)); box-shadow: -5px 0 20px rgba(0,0,0,0.05); display: flex; flex-direction: column; border-left: 1px solid var(--border); } .sidebar.open { transform: translateX(0); } .sidebar-section-title { font-size: 0.7rem; color: var(--text-sub); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; margin-top: 30px; font-weight: 600; }
.whatsapp-box { background: var(--bg-body); border: 1px solid var(--border); color: var(--text-main); padding: 15px; border-radius: 0; margin-top: 20px; } .wa-input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid var(--border); border-radius: 0; font-size: 0.95rem; background: var(--bg-card); } .wa-btn { width: 100%; background: var(--accent); color: var(--accent-text); border: none; padding: 10px; border-radius: 0; font-weight: bold; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 8px; font-size: 0.9rem; }
.tool-box { background: var(--bg-card); padding: 15px; border-radius: 0; border: 1px solid var(--border); margin-bottom: 10px; box-shadow: var(--shadow); } .currency-grid { display: grid; grid-template-columns: 1fr 30px 1fr; align-items: center; gap: 5px; margin-bottom: 8px; } .curr-group { display: flex; flex-direction: column; } .curr-label { font-size: 0.65rem; color: var(--text-sub); font-weight: bold; margin-bottom: 4px; padding-left: 2px;} .curr-input { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 0; font-size: 1.1rem; text-align: center; background: var(--bg-body); font-weight: 600; color: var(--text-main); } .rate-info-container { display: flex; justify-content: space-between; align-items: center; margin-top: 8px; font-size: 0.7rem; color: var(--text-sub);} .memo-area { width: 100%; height: 100px; padding: 10px; border: 1px solid var(--border); border-radius: 0; font-family: inherit; font-size: 0.9rem; resize: none; background: var(--bg-body); line-height: 1.5; color: var(--text-main); }
.sidebar-menu-btn { width: 100%; padding: 15px; background: var(--bg-body); border: 1px solid var(--border); color: var(--text-main); font-weight: 600; text-align: left; font-size: 0.95rem; display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 10px; box-shadow: var(--shadow); }

/* Phrase Overlay */
.phrase-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.98); z-index: 5000; display: flex; justify-content: center; align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.3s; } .phrase-overlay.active { opacity: 1; pointer-events: all; } .phrase-content { text-align: center; width: 90%; } .phrase-big { font-size: 3rem; font-weight: 800; color: #000; line-height: 1.2; margin-bottom: 20px; word-break: break-all; font-family: var(--font-heading); } .close-phrase { position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%); border: 1px solid #E5E5EA; padding: 10px 30px; border-radius: 30px; color: var(--text-main); cursor: pointer; background: var(--bg-card); font-weight: 600; box-shadow: 0 5px 20px rgba(0,0,0,0.05); }
@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
</style>
</head>
<body>

<script id="USER_DATA_CONFIG">
// 1. ğŸ¨ ç³»çµ±è¨­è¨ˆ (Design System)
const THEME_CONFIG = {
    accentColor: "#D4AF37",      // ç¥ç¤¾é‡‘ (è±¡å¾µå…‰ä¹‹é“èˆ‡å¤•é™½)
    accentText: "#FFFFFF",
    backgroundColor: "#F7F9FC",  // æ¥µç°¡ç°ç™½
    cardColor: "#FFFFFF",
    textColor: "#1a2e47",        // åšå¤šç£æ·±è—
    textSubColor: "#5e6c7e",     // æ¬¡è¦æ–‡å­—
    borderColor: "#B6A0C2",      // ç´«è—¤ç°
    googleFontsUrl: "https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@300;400;500;700&display=swap",
    fontHeading: '"Zen Kaku Gothic New", sans-serif',
    fontBody: '"Zen Kaku Gothic New", sans-serif'
};

// 2. ğŸ—“ï¸ æ—…ç¨‹åŸºæœ¬è¨­å®š
const CONFIG = {
    ui: {
        browserTitle: "ç¦å²¡äº”æ„Ÿç™‚ç™’ä¹‹æ—…",
        headerTitle: "ç¦å²¡äº”æ„Ÿ<span>ç™‚ç™’ä¹‹æ—…</span>",
        homeTimezone: "Asia/Hong_Kong",
        homeTimeLabel: "HKG"
    },
    startDate: "2026-02-14", 
    duration: 7
};

// 3. ğŸ“ ç›®çš„åœ°è³‡æ–™
const DESTINATION = {
    name: "ç¦å²¡ Fukuoka",
    lat: 33.5902, lon: 130.4207,
    timezone: "Asia/Tokyo",
    currency: "jpy", currencyLabel: "JPY", baseCurrency: "HKD"
};

// 4. âœˆï¸ èˆªç­èˆ‡ä½å®¿ (ç”¨æ–¼è³‡è¨Šé )
const TRIP_INFO = {
    visa: { type: "Visit Japan Web", number: "QR Ready", note: "å…¥å¢ƒèˆ‡å…ç¨…å¿…å‚™ï¼Œè«‹é å…ˆå­˜æª”ã€‚2æœˆç‚ºç¥­å…¸å·”å³°æœŸï¼Œäººæ½®çœ¾å¤šã€‚" },
    flights: [
        { type: "å»ç¨‹", flight: "UO6XX", date: "02/14", dep: "HKG 12:xx", arr: "FUK 17:10", note: "T2 ç™»æ©Ÿ / ææ—©åˆ°æ©Ÿå ´" },
        { type: "å›ç¨‹", flight: "UO669", date: "02/20", dep: "FUK 16:05", arr: "HKG 19:xx", note: "14:00 é ˆæŠµé”æ©Ÿå ´æ«ƒå°" }
    ],
    hotels: [
        { name: "Hotel Wing åšå¤šæ–°å¹¹ç·šå£", address: "ç¦å²¡å¸‚åšå¤šåŒºåšå¤šé§…æ±1-17-17", phone: "+81924310489", note: "ä½æ–¼åšå¤šç«™ã€ç­‘ç´«å£ã€ã€‚å–®èº«å¥³æ€§å…¥ä½æ¥µåº¦å®‰å…¨ï¼Œæ­¥è¡Œ 4 åˆ†é˜ã€‚" }
    ]
};

// 5. ğŸ—ºï¸ æ¯æ—¥è©³ç´°è¡Œç¨‹ (åŠ æ³•åŸå‰‡ï¼šå®Œæ•´ä¸‰é¤ + æ¥µè‡´ Modal)
const USER_ITINERARY = {
    "day1": {
        "events": [
            { 
                "time": "17:10", "title": "æŠµé”ç¦å²¡ç©ºæ¸¯ (FUK)", "type": "äº¤é€š", 
                "address": "ç¦å²¡ç©ºæ¸¯åœ‹éš›ç·šèˆªå»ˆ", "price": "å·´å£« Â¥270", "open_hours": "å…¨æ—¥",
                "tags": ["2è™Ÿä¹˜è»Šè™•"], "moodColor": "#1a2e47",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘å…¥å¢ƒå¾Œå‡ºå¤§é–€ï¼Œåœ¨ã€2è™Ÿä¹˜è»Šè™•ã€æ­ä¹˜å¾€åšå¤šç«™çš„æ©Ÿå ´ç›´é”å·´å£«ã€‚è«‹åœ¨ã€åšå¤šé§…ç­‘ç´«å£ã€ä¸‹è»Šã€‚"
            },
            { 
                "time": "18:15", "title": "Check-in: Hotel Wing", "type": "ä½å®¿", 
                "address": "ç¦å²¡å¸‚åšå¤šåŒºåšå¤šé§…æ±1-17-17", "phone": "+81924310489", "price": "å·²é ç´„", "open_hours": "24H",
                "tags": ["ç­‘ç´«å£"], "moodColor": "#000",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘ä¸‹å·´å£«å¾Œé¢å‘è»Šç«™å‘å³è½‰ï¼Œæ²¿å¤§é¦¬è·¯ç›´èµ°ï¼Œéç¬¬ä¸€å€‹ç´…ç¶ ç‡ˆå³æ‰‹é‚Šå³æ˜¯ã€‚"
            },
            { 
                "time": "18:45", "title": "æ™šé¤ï¼šåšå¤šç‰›è…¸é‹ å‰ç”°å±‹", "type": "ç¾é£Ÿ", 
                "address": "ç¦å²¡å¸‚åšå¤šåŒºåšå¤šé§…æ±2-1-24", "phone": "+81924828558", "price": "Â¥4,000~", "open_hours": "11:00-23:00",
                "tags": ["å…ˆåƒé£½å†é€›", "å’Œç‰›"], "moodColor": "#d63345",
                "note": "ã€é ç´„å®‰æ’ã€‘å¿…é ˆæå‰é ç´„ã€‚å‘³å™Œæ¹¯åº•é…å’Œç‰›è–„åˆ‡æ¥µè‡´ç™‚ç™’ã€‚\nã€å¿…åƒã€‘å‘³å™Œå£å‘³ç‰›è…¸é‹ã€é†‹å…§è‡Ÿã€‚"
            },
            { 
                "time": "20:30", "title": "å¤œé–“è³¼ç‰©ï¼šYodobashi & è¶…å¸‚", "type": "è³¼ç‰©", 
                "address": "ç¦å²¡å¸‚åšå¤šåŒºåšå¤šé§…ä¸­å¤®è¡—6-12", "phone": "+81924711010", "price": "ä¾é ç®—", "open_hours": "09:30-22:00",
                "tags": ["å¯¦ç”¨å¥½ç‰©"], "moodColor": "#D4AF37",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘é£¯åº—æ­¥è¡Œ 2 åˆ†é˜ã€‚\nã€æ”»ç•¥ã€‘3F æ‰¾ Snow Peak æˆ–æ—¥æœ¬è£½ä¿æº«ç“¶ã€‚æœ€å¾Œå» MaxValu è¶…å¸‚è²·ç”˜ç‹è‰è“ç•¶å®µå¤œã€‚"
            }
        ],
        "inspiration": [{ "title": "å‚™æ¡ˆï¼šä½å‰é…’è²©", "tag": "SAKE", "note": "è‹¥æƒ³è²·ç¬¬ä¸€æ”¯é…’ï¼ŒDeitos Annex 1F é–‹åˆ° 21:00ã€‚", "type": "è³¼ç‰©", "address": "Hakata Deitos" }],
        "shopping": ["ç”˜ç‹è‰è“", "æ—¥æœ¬è£½è±¡å°ä¿æº«ç“¶", "ä¼‘è¶³æ™‚é–“"]
    },
    "day2": {
        "events": [
            { 
                "time": "08:30", "title": "æ—©é¤ï¼šç‰›èˆŒå®šé£Ÿ ãŸã‚“ã‚„", "type": "ç¾é£Ÿ", 
                "address": "åšå¤šä¸€ç•ªè¡— B1", "price": "Â¥800", "open_hours": "07:00-",
                "tags": ["åšå¤šäººæ°£"], "moodColor": "#D4AF37",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘ä½æ–¼åšå¤šç«™åšå¤šå£ B1ã€‚çƒ¤ç‰›èˆŒå±±è—¥æ³¥å®šé£Ÿæ˜¯ç¦å²¡æœ€è‘—åçš„ç‡Ÿé¤Šæ—©é¤ã€‚"
            },
            { 
                "time": "10:00", "title": "è­·åœ‹ç¥ç¤¾ èš¤ä¹‹å¸‚", "type": "å¸‚é›†", 
                "address": "ä¸­å¤®åŒºå…­æœ¬æ¾1-1-1", "price": "å…è²»", "open_hours": "09:00-16:00",
                "tags": ["æ˜­å’Œå¤ç‰©"], "moodColor": "#B6A0C2",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘åœ°éµä¸ƒéšˆç·šã€åšå¤šç«™ã€3è™Ÿæœˆå°æ­è‡³ã€å…­æœ¬æ¾ç«™ã€ã€‚2è™Ÿå‡ºå£æ­¥è¡Œ 8 åˆ†ã€‚\nã€æ”»ç•¥ã€‘å°‹æ‰¾æ˜­å’Œå¾©å¤ç»ç’ƒæ¯èˆ‡é™¶å™¨ã€‚"
            },
            { 
                "time": "12:30", "title": "åˆé¤ï¼šå…­æœ¬æ¾ è”¦å±‹è¼•é£Ÿ", "type": "ç¾é£Ÿ", 
                "address": "Ropponmatsu 421", "price": "Â¥1,500", "open_hours": "10:00-22:00",
                "tags": ["è¨­è¨ˆæ„Ÿ"], "moodColor": "#1a2e47",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘å›åˆ°åœ°éµç«™æ—çš„å¤§æ¨“ã€‚åœ¨æ–‡é’æ„Ÿåè¶³çš„è”¦å±‹æ›¸åº—å…§äº«ç”¨è¼•é£Ÿï¼Œè£œå……é«”åŠ›ã€‚"
            },
            { 
                "time": "14:30", "title": "ğŸ¶ é…’è—ç¥­ï¼šåŸå³¶é…’è—ã³ã‚‰ã", "type": "é«”é©—", 
                "address": "ä¹…ç•™ç±³å¸‚åŸå³¶ç”º", "price": "Â¥1,500", "open_hours": "09:30-16:00",
                "tags": ["é‡‘æ°´èƒ½é‡", "é…’é¬¼å¤©å ‚"], "moodColor": "#D4AF37",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘åœ°éµå›åšå¤š -> JR é¹¿å…’å³¶æœ¬ç·šå¾€ã€è’æœ¨ç«™ã€ -> è½‰æ­ç¥­å…¸æ¥é§è»Šã€‚\nã€é‡é»ã€‘è³¼è²·è©¦é£²åˆ¸ï¼Œå–éå„å®¶é…’é€ ç”ŸåŸé…’ã€‚"
            },
            { 
                "time": "18:30", "title": "æ™šé¤ï¼šé³¥é¶ç ”ç©¶åœ˜ (ç²¾å“ç‡’é³¥)", "type": "ç¾é£Ÿ", 
                "address": "åšå¤šåŒºåšå¤šé§…å‰4-18-19", "phone": "+81922609556", "price": "Â¥5,500", "open_hours": "17:30-23:00",
                "tags": ["ç¾ä»£ç‡’é³¥"], "moodColor": "#d63345",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘JR å›åšå¤šç«™ç”±åšå¤šå£æ­¥è¡Œ 8 åˆ†ã€‚\nã€é ç´„å®‰æ’ã€‘å¿…é ˆé ç´„ã€‚é«”é©—è·äººç‚­ç«è—è¡“ï¼Œé…ä¸Šä¸€æ¯é«˜è³ªå¤§åŸé‡€ã€‚"
            }
        ],
        "inspiration": [{ "title": "å‚™æ¡ˆï¼šå…­æœ¬æ¾ è”¦å±‹æ›¸åº—", "tag": "ART", "note": "è‹¥å¸‚é›†ä¸‹é›¨ï¼Œé€™è£¡æ˜¯éå¸¸æ£’çš„å®¤å…§è¨­è¨ˆç©ºé–“ã€‚", "type": "æ”¾é¬†", "address": "Ropponmatsu 421" }],
        "shopping": ["æ˜­å’Œç»ç’ƒæ¯", "åŸå³¶é™å®šé…’"]
    },
    "day3": {
        "events": [
            { 
                "time": "09:00", "title": "æ—©é¤ï¼šè¥¿éµç¦å²¡ç«™è¼•é£Ÿ", "type": "ç¾é£Ÿ", 
                "address": "è¥¿éµç¦å²¡(å¤©ç¥)ç«™", "price": "Â¥1,000", "open_hours": "07:30-",
                "tags": ["è¥¿éµç·š"], "moodColor": "#1a2e47",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘åœ°éµåšå¤šè‡³å¤©ç¥ï¼Œæ­¥è¡Œè‡³è¥¿éµç¦å²¡ç«™ 1-2 è™Ÿæœˆå°æ­ã€æ—…äººè™Ÿã€ç‰¹æ€¥ã€‚"
            },
            { 
                "time": "10:30", "title": "å¤ªå®°åºœå¤©æ»¿å®®", "type": "åƒæ‹œ", 
                "address": "å¤ªå®°åºœå¸‚", "price": "å…è²»", "open_hours": "06:00-19:00",
                "tags": ["æ¢…èŠ±", "å­¸å•"], "moodColor": "#D4AF37",
                "note": "ã€æ”»ç•¥ã€‘äºŒæœˆæ¢…èŠ±ç››é–‹ã€‚æ‘¸éŠ…ç‰›ã€åƒç¾çƒ¤æ¢…æé¤…ï¼Œæ„Ÿå—åƒå¹´å­¸å•å®ˆè­·åŠ›ã€‚"
            },
            { 
                "time": "12:30", "title": "åˆé¤ï¼šå¤ªå®°åºœè¡¨åƒé“ç¾é£Ÿ", "type": "ç¾é£Ÿ", 
                "address": "å¤ªå®°åºœå¸‚è¡¨åƒé“", "price": "Â¥2,000", "open_hours": "11:00-",
                "tags": ["åœ¨åœ°æ»‹å‘³"], "moodColor": "#d63345",
                "note": "ã€æ¨è–¦ã€‘é¸ä¸€å®¶æœ‰åº­é™¢çš„çƒé¾éºµåº—äº«ç”¨åˆé¤ã€‚é¤å¾Œæ­ä¹˜å·´å£«å‰å¾€ç«ˆé–€ç¥ç¤¾ã€‚"
            },
            { 
                "time": "14:00", "title": "ç«ˆé–€ç¥ç¤¾ (è‰¯ç·£/ç¾å­¸)", "type": "ç¥ˆç¦", 
                "address": "å¤ªå®°åºœå¸‚å†…å±±883", "price": "å·´å£« Â¥100", "open_hours": "08:30-18:00",
                "tags": ["çµ•ç¾ç¤¾å‹™æ‰€"], "moodColor": "#d63345",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘å¤ªå®°åºœç«™å‰æ­ç¤¾å€å·´å£«ã€ã¾ã»ã‚ã°å·ã€ã€‚è²·ã€Œçµç·£ç´…ç·šã€ï¼Œè¨­è¨ˆæ„Ÿæ¥µå¼·ã€‚"
            },
            { 
                "time": "17:30", "title": "ğŸ”® å åœé…’å§ WIND AGE", "type": "ç¥ç§˜å­¸", 
                "address": "å¤§é‡åŸå¸‚ä¸‹å¤§åˆ©3-2-20", "phone": "+81925961313", "price": "Â¥3,500", "open_hours": "19:00-24:00",
                "tags": ["å¡”ç¾…", "éš±ä¸–"], "moodColor": "#7E57C2",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘æ­è¥¿éµè‡³ã€ä¸‹å¤§åˆ©ç«™ã€æ­¥è¡Œ 5 åˆ†ã€‚\nã€é ç´„å®‰æ’ã€‘å¿…é ˆ IG (@windage_fukuoka) é ç´„ã€‚åœ¨é§•è¨“ç­å…§çš„ç¥ç§˜åŸºåœ°ã€‚"
            },
            { 
                "time": "20:30", "title": "æ™šé¤ï¼šShin-Shin æ‹‰éºµ (åšå¤š)", "type": "ç¾é£Ÿ", 
                "address": "åšå¤šé§…å…§ Deitos 2F", "price": "Â¥980", "open_hours": "11:00-23:00",
                "tags": ["åšå¤šç¶“å…¸"], "moodColor": "#1a2e47",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘æ­è¥¿éµ/JR å›åšå¤šç«™ã€‚ç°¡å–®æº«æš–çš„åšå¤šç´°éºµæ‹‰éºµæ”¶å°¾ã€‚"
            }
        ],
        "inspiration": [{ "title": "å‚™æ¡ˆï¼šäºŒæ—¥å¸‚æº«æ³‰ åšå¤šæ¹¯", "tag": "SPA", "note": "è‹¥ä¸æƒ³å åœï¼Œå¯åœ¨äºŒæ—¥å¸‚ç«™ä¸‹è»Šæ³¡ 1300 å¹´å¤æ¹¯ã€‚", "type": "æº«æ³‰", "address": "äºŒæ—¥å¸‚æº«æ³‰" }],
        "shopping": ["çµç·£ç´…ç·šå¾¡å®ˆ", "æ¢…æé¤…"]
    },
    "day4": {
        "events": [
            { 
                "time": "09:00", "title": "æ—©é¤ï¼šåšå¤šç«™å…§è¼•é£Ÿ", "type": "ç¾é£Ÿ", 
                "address": "åšå¤šç«™", "price": "Â¥800", "open_hours": "07:30-",
                "tags": ["å‡ºç™¼"], "moodColor": "#1a2e47",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘JR é¹¿å…’å³¶æœ¬ç·šå¾€ã€åŸºå±±ç«™ã€ -> è½‰ç”˜æœ¨éµé“è‡³ã€å¤ªåˆ€æ´—ç«™ã€ã€‚"
            },
            { 
                "time": "10:00", "title": "ğŸº å•¤é…’è¦‹å­¸ï¼šéº’éºŸå·¥å» ", "type": "é«”é©—", 
                "address": "æœå€‰å¸‚é¦¬ç”°3601", "phone": "+81946232132", "price": "Â¥500", "open_hours": "09:30-15:30",
                "tags": ["ç¾é‡€å•¤é…’"], "moodColor": "#FBC02D",
                "note": "ã€é ç´„å®‰æ’ã€‘å¿…é ˆå®˜ç¶²é ç´„ã€‚å°è¦½å¾Œæœ‰ 3 æ¯ç¾é‡€å•¤é…’è©¦é£²ï¼Œæ­é…çƒ¤è‚‰åˆé¤ã€‚"
            },
            { 
                "time": "12:30", "title": "åˆé¤ï¼šå·¥å» å…§æˆå‰æ€æ±—çƒ¤è‚‰", "type": "ç¾é£Ÿ", 
                "address": "Beer Farm", "price": "Â¥3,000", "open_hours": "11:00-",
                "tags": ["å¤§å£åƒè‚‰"], "moodColor": "#d63345",
                "note": "ã€æ”»ç•¥ã€‘æ–°é®®å•¤é…’é…ä¸Šçƒ¤è‚‰å®šé£Ÿï¼Œæ˜¯å¤§å£å–é…’åƒè‚‰çš„æœ€é«˜äº«å—ã€‚"
            },
            { 
                "time": "15:00", "title": "åƒæ‹œï¼šè­¦å›ºç¥ç¤¾ (æ¶ˆç½)", "type": "åƒæ‹œ", 
                "address": "å¤©ç¥2-2-20", "price": "å…è²»", "open_hours": "å…¨æ—¥",
                "tags": ["éƒ½å¸‚ç¶ æ´²", "è¶³æ¹¯"], "moodColor": "#4CAF50",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘åœ°éµæ©Ÿå ´ç·šã€å¤©ç¥ç«™ã€ã€‚é¬§å€ä¸­çš„å®ˆè­·ç¥ï¼Œæœ‰æº«æš–è¶³æ¹¯å¯æ³¡ã€‚"
            },
            { 
                "time": "16:30", "title": "ğŸ§ª èƒ½é‡èª¿é¦™é«”é©—", "type": "é«”é©—", 
                "address": "MY ONLY FRAGRANCE ç¦å²¡åº—", "price": "Â¥5,500", "open_hours": "11:00-20:00",
                "tags": ["å—…è¦ºç™‚ç™’"], "moodColor": "#B6A0C2",
                "note": "ã€é ç´„å®‰æ’ã€‘å¿…é ˆå®˜ç¶²é ç´„ã€‚èª¿è£½å±¬æ–¼æ‚¨çš„èƒ½é‡é¦™æ°´ã€‚å–ä»£å†—é•·çš„è³¼ç‰©æ™‚é–“ã€‚"
            },
            { 
                "time": "18:30", "title": "æ™šé¤ï¼šæ¿±ç”°å±‹ æ°´ç‚Šé‹", "type": "ç¾é£Ÿ", 
                "address": "JRåšå¤šCity 10F", "phone": "+81924096898", "price": "Â¥6,000", "open_hours": "11:00-22:00",
                "tags": ["é›æ¹¯ç²¾è¯"], "moodColor": "#1a2e47",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘å›åšå¤šç«™ã€‚é›æ¹¯åº•æ¥µé®®ï¼Œæ˜¯ç¦å²¡ä»£è¡¨æ€§çš„ç™‚ç™’ç¾é£Ÿã€‚"
            }
        ],
        "inspiration": [{ "title": "å‚™æ¡ˆï¼šå¤©ç¥åœ°ä¸‹è¡— Tabio", "tag": "SHOP", "note": "è‹¥èª¿é¦™å¾Œæœ‰ç©ºï¼Œå»è²·æ—¥æœ¬è£½æ‰‹å·¥è¥ªã€‚", "type": "è³¼ç‰©", "address": "å¤©ç¥åœ°ä¸‹è¡—" }],
        "shopping": ["å°ˆå±¬èƒ½é‡é¦™æ°´"]
    },
    "day5": {
        "events": [
            { 
                "time": "08:30", "title": "æ—©é¤ï¼šTrandor åšå¤šç«™éºµåŒ…", "type": "ç¾é£Ÿ", 
                "address": "åšå¤šç«™", "price": "Â¥800", "open_hours": "07:00-",
                "tags": ["å±±é–“è¡Œ"], "moodColor": "#1a2e47",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘æ­ JR ç¯ æ —ç·šå¾€ã€ç¯ æ —ã€æ–¹å‘ï¼Œåœ¨ã€åŸæˆ¶å—è—é™¢å‰ç«™ã€ä¸‹è»Šã€‚"
            },
            { 
                "time": "09:30", "title": "å—è—é™¢ (é’éŠ…è‡¥ä½›)", "type": "åƒæ‹œ", 
                "address": "ç¯ æ —ç”º1035", "price": "å…è²»", "open_hours": "09:00-16:30",
                "tags": ["å±±éˆèƒ½é‡", "é‡‘é‹"], "moodColor": "#D4AF37",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘å‡ºç«™æ­¥è¡Œ 3 åˆ†ã€‚é ˜å–è‡¥ä½›é‡‘é‹å¾¡å®ˆï¼Œæ„Ÿå—éœ‡æ’¼çš„å±±éˆèƒ½é‡ã€‚"
            },
            { 
                "time": "12:30", "title": "åˆé¤ï¼šåšå¤šèˆŠå¸‚è¡—è€åº—", "type": "ç¾é£Ÿ", 
                "address": "æ«›ç”°ç¥ç¤¾å‘¨é‚Š", "price": "Â¥2,000", "open_hours": "11:30-",
                "tags": ["åœ¨åœ°æ»‹å‘³"], "moodColor": "#d63345",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘JR å›åšå¤šç«™ã€‚æ¨è–¦æ«›ç”°ç¥ç¤¾å‘¨é‚Šçš„ç™¾å¹´çƒé¾éºµæˆ–å£½å¸åº—ã€‚"
            },
            { 
                "time": "13:30", "title": "å¸‚å·é¦™èˆ— (å¤é¦™é«”é©—)", "type": "é«”é©—", 
                "address": "åšå¤šåŒºä¸Šå·ç«¯ç”º11-28", "phone": "+81922910543", "price": "ä¾æ¶ˆè²»", "open_hours": "10:00-18:30",
                "tags": ["å—…è¦ºéˆé­‚", "æ±Ÿæˆ¶è€èˆ–"], "moodColor": "#B6A0C2",
                "note": "ã€å—…è¦ºç™‚ç™’ã€‘æ±Ÿæˆ¶æ™‚ä»£è€åº—ã€‚æŒ‘é¸é«˜å“è³ªå¤©ç„¶ç·šé¦™ï¼Œé«”é©—å‚³çµ±ã€å’Œé¦™ã€ä¹‹ç¾ã€‚"
            },
            { 
                "time": "15:00", "title": "ğŸ›ï¸ ç”Ÿæ´»ç¾å­¸ï¼šB.B.B. POTTERS", "type": "è³¼ç‰©", 
                "address": "ä¸­å¤®åŒºè–¬é™¢1-8-8", "phone": "+81927392080", "price": "ä¾é ç®—", "open_hours": "11:00-20:00",
                "tags": ["è—¥é™¢", "æ³¢ä½è¦‹ç‡’"], "moodColor": "#8D6E63",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘åœ°éµæ­è‡³ã€è—¥é™¢ç«™ã€ã€‚å…¨æ£Ÿç”Ÿæ´»é›œè²¨é¸ç‰©ï¼Œæ¨è–¦æ¥­å‹™ç”¨è€ç”¨å™¨çš¿ã€‚"
            },
            { 
                "time": "16:30", "title": "Abeki (è¦–è¦ºç¦ªæ„å’–å•¡)", "type": "æ”¾é¬†", 
                "address": "ä¸­å¤®åŒºè–¬é™¢1-12-28", "price": "Â¥1,500", "open_hours": "12:00-17:30",
                "tags": ["å‘³è¦ºè–æ®¿", "éœè¬"], "moodColor": "#000",
                "note": "ã€è¦–è¦ºèˆ‡å‘³è¦ºã€‘ç™½è‰²è–å ‚èˆ¬çš„ç©ºé–“ï¼Œåº—ä¸»æ¥µå…·å„€å¼æ„Ÿã€‚å¿…é»èµ·å¸è›‹ç³•ã€‚"
            },
            { 
                "time": "17:30", "title": "ğŸ’†ğŸ»â€â™€ï¸ çå‹µï¼šDry Head Spa", "type": "æ”¾é¬†", 
                "address": "å¤§åå€åŸŸ", "price": "Â¥6,500", "open_hours": "10:00-21:00",
                "tags": ["è§¸è¦ºç™‚ç™’"], "moodColor": "#1a2e47",
                "note": "ã€é ç´„å®‰æ’ã€‘é ç´„ã€æ‚Ÿç©ºã®ãã‚‚ã¡ã€ã€‚ç‚ºæ˜å¤©ç¥­å…¸é«˜å³°å¾¹åº•æ’ç©ºé›œå¿µã€‚"
            },
            { 
                "time": "19:30", "title": "æ™šé¤/ğŸ»ï¼šFukuoka Craft", "type": "ç¾é£Ÿ", 
                "address": "ä¸­å¤®åŒºå¤§å", "price": "Â¥3,500", "open_hours": "15:00-23:00",
                "tags": ["åœ¨åœ°ç²¾é‡€"], "moodColor": "#FFA000",
                "note": "ã€äº¤é€šã€‘å°±åœ¨å¤§åæŒ‰æ‘©å¾Œã€‚ç¦å²¡åœ¨åœ°ç²¾é‡€å•¤é…’ï¼Œå¾®é†ºçµæŸå®Œç¾ä¸€å¤©ã€‚"
            }
        ],
        "inspiration": [{ "title": "å‚™æ¡ˆï¼šäºæ´²ç¾è¡“é¤¨", "tag": "ART", "note": "ä¸­æ´²å·ç«¯ç«™ç›´é”ï¼Œç©ºé–“éå¸¸éœè¬ã€‚", "type": "æ–‡åŒ–", "address": "Hakata Riverain" }],
        "shopping": ["å¤©ç„¶ç·šé¦™", "æ³¢ä½è¦‹ç‡’é¤å…·", "è·äººæ¯›å·¾"]
    },
    "day6": {
        "events": [
            { 
                "time": "09:30", "title": "æ—©é¤ï¼šLe Boulanger Mariage", "type": "ç¾é£Ÿ", 
                "address": "åšå¤šç«™", "price": "Â¥1,000", "open_hours": "07:30-",
                "tags": ["é«˜è³ªéºµåŒ…"], "moodColor": "#1a2e47",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘JR åšå¤šç«™ -> ç¦é–“ç«™ (é¹¿å…’å³¶æœ¬ç·šæœˆå°) -> è½‰æ­è‡¨æ™‚å·´å£«ã€‚"
            },
            { 
                "time": "11:30", "title": "ğŸŒŸ é—œéµï¼šç”³è«‹ç‰¹åˆ¥ç¥ˆé¡˜å¸­", "type": "èƒ½é‡", 
                "address": "å®®åœ°å¶½ç¥ç¤¾ ç¥ˆé¡˜å—ä»˜", "price": "ç¥ˆé¡˜ Â¥5,000", "open_hours": "ç¾å ´å ±å",
                "tags": ["VIP è¦–é‡", "2/19é¦–æ—¥"], "moodColor": "#FFA000",
                "note": "ã€é‡è¦ã€‘ç¥­å…¸é¦–æ—¥ç™¸äº¥å¤§æµ·æ°´ï¼ç«‹åˆ»ç”³è«‹ã€å¤•æ—¥ã®ç¥­ ç‰¹åˆ¥ç¥ˆé¡˜ã€ï¼Œç¢ºä¿è§€è³ä½ã€‚"
            },
            { 
                "time": "13:00", "title": "åˆé¤ï¼šç¦é–“æµ·å²¸æµ·é‚Šå’–å•¡", "type": "ç¾é£Ÿ", 
                "address": "ç¦é–“æµ·å²¸", "price": "Â¥2,000", "open_hours": "11:00-",
                "tags": ["æ°´èƒ½é‡"], "moodColor": "#1a2e47",
                "note": "åœ¨æµ·é‚Šäº«ç”¨ç°¡é¤ï¼Œæ„Ÿå—ç™¸äº¥æ—¥å¤§æµ·æ°´çš„æºé ­åŠ›é‡ã€‚"
            },
            { 
                "time": "14:30", "title": "å¥§ä¹‹å®®å…«ç¤¾å·¡ç¦®", "type": "åƒæ‹œ", 
                "address": "å®®åœ°å¶½ç¥ç¤¾ å¥§ä¹‹å®®", "price": "å…è²»", "open_hours": "å…¨æ—¥",
                "tags": ["æ·±åº¦ç¥ˆç¦"], "moodColor": "#4CAF50",
                "note": "åœ¨ç¥æ®¿å¾Œæ–¹å…«åº§å°ç¥ç¤¾åƒæ‹œï¼Œæ´—æ»Œæ°£å ´ï¼Œè¿æ¥é»ƒé‡‘æ™‚åˆ»ã€‚"
            },
            { 
                "time": "17:55", "title": "çµ•æ™¯æ™‚åˆ»ï¼šå…‰ä¹‹é“", "type": "çµ•æ™¯", 
                "address": "å®®åœ°å¶½ç¥ç¤¾ éšæ¢¯", "price": "ç„¡åƒ¹", "open_hours": "æ—¥è½",
                "tags": ["é‡‘æ°´ç›¸ç”Ÿ", "å·”å³°æ„Ÿå®˜"], "moodColor": "#FFFFFF",
                "note": "ã€é‡‘æ°´ç›¸ç”Ÿã€‘é‡‘è‰²é™½å…‰ç›´é€šç„ç•Œç˜ã€‚é€™æ˜¯éˆé­‚æœ€éœ‡æ’¼çš„ç™‚ç™’é ‚é»ã€‚"
            },
            { 
                "time": "20:30", "title": "æ™šé¤ï¼šç‰›è…¸é‹ ä¸€åˆ© (Ichitaka)", "type": "ç¾é£Ÿ", 
                "address": "åšå¤šé§…æ±2-4-14", "phone": "+81924096500", "price": "Â¥5,500", "open_hours": "17:00-23:00",
                "tags": ["æ…¶åŠŸå®´"], "moodColor": "#d63345",
                "note": "å›åšå¤šç«™åƒæ…¶åŠŸé¤ã€‚æ¨è–¦èƒ¡éº»é¯–é­šé…å†°æ¶¼ç”Ÿå•¤é…’ã€‚"
            }
        ],
        "inspiration": [{ "title": "å‚™æ¡ˆï¼šå®®åœ°æ¿±æµ·ç˜", "tag": "SEA", "note": "è‹¥ç¥ç¤¾äººæ½®å¤ªéæ“ æ“ï¼Œæµ·ç˜çœ‹å¤•é™½èƒ½é‡æ›´ç´”æ·¨ã€‚", "type": "é¢¨æ™¯", "address": "å®®åœ°æ¿±" }],
        "shopping": ["å…‰ä¹‹é“é™å®šé‡‘é‹å¾¡å®ˆ", "å®®åœ°å¶½å¤§æ³¨é€£ç¹©å®ˆ"]
    },
    "day7": {
        "events": [
            { 
                "time": "09:30", "title": "æ—©é¤ï¼šCheck-out èˆ‡æœ€å¾Œæ¡è²·", "type": "ç¾é£Ÿ", 
                "address": "Hotel Wing / åšå¤šç«™", "price": "Â¥1,000", "open_hours": "07:30-",
                "tags": ["æœ€å¾Œæ™‚å…‰"], "moodColor": "#000",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘è¡Œæå¯„å­˜é£¯åº—ã€‚å‰å¾€ AMU PLAZA è£œé½Šæœ€å¾Œä¼´æ‰‹ç¦®ã€‚"
            },
            { 
                "time": "10:30", "title": "ğŸ›ï¸ æœ€å¾Œè£œè²¨ï¼šAMU PLAZA", "type": "è³¼ç‰©", 
                "address": "JRåšå¤šCity", "price": "ä¾é ç®—", "open_hours": "10:00-20:00",
                "tags": ["ä¸­å·æ”¿ä¸ƒ", "æœ€å¾Œè£œè²¨"], "moodColor": "#d63345",
                "note": "ã€æ”»ç•¥ã€‘1F ä¸­å·æ”¿ä¸ƒå•†åº—è²·æ—¥æœ¬è£½èŠ±å¸ƒå·¾ã€‚B1 è²·ã€éˆ´æ‡¸ã€è‰è“å¤§ç¦ã€‚"
            },
            { 
                "time": "11:30", "title": "ğŸ¶ é…’é€ æœ€å¾Œå·¡ç¦®ï¼šç™¾å¹´è”µ", "type": "é«”é©—", 
                "address": "åšå¤šåŒºå …ç²•1-30-1", "phone": "+81926335100", "price": "å…è²»", "open_hours": "11:00-19:00",
                "tags": ["ç™¾å¹´æ­·å²"], "moodColor": "#D4AF37",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘åšå¤šç«™æ­è¨ˆç¨‹è»Š (ç´„ Â¥1,000)ã€‚åƒè§€ç¦å²¡å”¯ä¸€çš„ç™¾å¹´é…’é€ ï¼Œè²·æœ€å¾Œæ¸…é…’ã€‚"
            },
            { 
                "time": "12:30", "title": "åˆé¤ï¼šé®¨å‰²çƒ¹ ã‚„ã¾ä¸­", "type": "ç¾é£Ÿ", 
                "address": "JRåšå¤šCity 9F", "phone": "+81924096688", "price": "Â¥6,000", "open_hours": "11:00-22:00",
                "tags": ["é ‚ç´šå£½å¸", "æ„Ÿè¬è‡ªå·±"], "moodColor": "#1a2e47",
                "note": "ã€é ç´„å®‰æ’ã€‘å¿…é ˆé ç´„ã€‚ç”¨æ±Ÿæˆ¶å‰å£½å¸ç‚ºæ—…ç¨‹åŠƒä¸‹å®Œç¾å¥é»ã€‚"
            },
            { 
                "time": "14:15", "title": "æ­¸ç¨‹ï¼šæ©Ÿå ´ç›´é”å·´å£«", "type": "äº¤é€š", 
                "address": "åšå¤šå·´å£«ç¸½ç«™ 1F 11è™Ÿæœˆå°", "price": "Â¥270", "open_hours": "-",
                "tags": ["å¸¶è‘—èƒ½é‡å›æ¸¯"], "moodColor": "#1a2e47",
                "note": "ã€äº¤é€šæŒ‡å—ã€‘11 è™Ÿæœˆå°æ­ä¹˜æ©Ÿå ´ç›´é”å·´å£«ã€‚16:05 é£›æ©Ÿèµ·é£›ã€‚"
            }
        ],
        "inspiration": [{ "title": "å‚™æ¡ˆï¼šNana's Green Tea", "tag": "SWEET", "note": "è‹¥é‚„æœ‰èƒƒå£ï¼Œåƒæœ€å¾Œä¸€æ¯æŠ¹èŒ¶è–ä»£ã€‚", "type": "ç”œé»", "address": "JRåšå¤šCity" }],
        "shopping": ["ä¸­å·æ”¿ä¸ƒèŠ±å¸ƒå·¾", "éˆ´æ‡¸è‰è“å¤§ç¦", "ç™¾å¹´è”µé™å®šæ¸…é…’"]
    }
};

const PHRASE_DATA = [
    {
        category: "ç¾é…’èˆ‡ç¥­å…¸",
        items: [
            { term_primary: "ç‰¹åˆ¥ç¥ˆé¡˜ã‚’ã—ãŸã„ã§ã™", term_secondary: "æˆ‘æƒ³åƒåŠ ç‰¹åˆ¥ç¥ˆé¡˜ (ç²å–å¸­ä½)", term_pronounce: "Tokubetsu kigan shitai" },
            { term_primary: "ãŠã™ã™ã‚ã®æ—¥æœ¬é…’ã¯ï¼Ÿ", term_secondary: "æ¨è–¦å“ªæ”¯æ¸…é…’?", term_pronounce: "Osusume no nihonshu wa?" }
        ]
    }
];
</script>    
<div id="toast"><i class="fa-solid fa-circle-check"></i> <span id="toast-msg">Action Completed</span></div>
<header>
<div>
<h1 id="app-title">TRIP PLANNER</h1>
<div id="home-clock">--:--</div>
</div>
<div class="header-actions">
<div class="header-btn" onclick="openTranslate()"><i class="fa-solid fa-language"></i></div>
<div class="header-btn" onclick="toggleSidebar()"><i class="fa-solid fa-bars"></i></div>
</div>
</header>
<div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>
<div class="sidebar" id="sidebar">
<div class="sidebar-menu-btn" onclick="openPhrasePage()">
<i class="fa-solid fa-book-open"></i> ğŸ“– æ—…è¡ŒçŸ­èª
</div>
<div class="whatsapp-box">
<div style="font-weight:bold; margin-bottom:5px;"><i class="fa-brands fa-whatsapp"></i> å®‰å…¨ Check-in</div>
<input type="tel" id="wa-phone" class="wa-input" placeholder="å°æ–¹é›»è©± (å¦‚ 85291234567)">
<button class="wa-btn" id="wa-btn" onclick="sendWhatsApp()"><i class="fa-solid fa-paper-plane"></i> ç™¼é€ä½ç½®</button>
</div>
<div class="sidebar-section-title">å·¥å…·ç®±</div>
<div class="tool-box">
<div style="font-weight:bold; margin-bottom:15px;">åŒ¯ç‡æ›ç®—</div>
<div class="currency-grid">
<div class="curr-group"><span class="curr-label" id="lbl-curr-target">TARGET</span><input type="number" id="curr-jpy" class="curr-input" placeholder="0" oninput="convertCurrency()"></div>
<div class="curr-icon"><i class="fa-solid fa-right-left"></i></div>
<div class="curr-group"><span class="curr-label" id="lbl-curr-base">BASE</span><input type="number" id="curr-hkd" class="curr-input" placeholder="0" readonly></div>
</div>
<div class="rate-info-container">
<div id="rate-status" class="rate-status">è¼‰å…¥ä¸­...</div>
<div style="display:flex; gap:10px;"><span onclick="fetchRates(true)" style="color:#007AFF; cursor:pointer;">åˆ·æ–°</span></div>
</div>
</div>
<div class="tool-box">
<div style="font-weight:bold; margin-bottom:10px;">éš¨æ‰‹è¨˜</div>
<textarea id="quick-memo" class="memo-area" placeholder="ç­†è¨˜..." oninput="saveMemo()"></textarea>
</div>
</div>
<div id="phrase-overlay" class="phrase-overlay" onclick="closePhrase()">
<div class="phrase-content"><div id="overlay-jp" class="phrase-big"></div><div id="overlay-zh" class="phrase-sub"></div></div>
<div class="close-phrase">é—œé–‰</div>
</div>
<div class="date-selector-container"><div class="date-selector" id="date-selector"></div></div>
<main>
<div id="page-itinerary" class="page active"><div class="timeline-container" id="timeline-container"></div></div>
<div id="page-inspiration" class="page">
<div class="filter-bar-container">
<span class="filter-chip active" onclick="filterInspiration('all', this)">å…¨éƒ¨</span>
<span class="filter-chip" onclick="filterInspiration('RAINY', this)">â˜” é›¨å¤©</span>
<span class="filter-chip" onclick="filterInspiration('TIRED', this)">â˜• ä¼‘æ¯</span>
<span class="filter-chip" onclick="filterInspiration('PHOTO', this)">ğŸ“· æ‹ç…§</span>
</div>
<div id="inspiration-container" class="inspiration-grid"></div>
</div>
<div id="page-shopping" class="page"><div class="page-header"><h2 class="page-title">è³¼ç‰©æ¸…å–®</h2></div><div id="shopping-container" class="shopping-list"></div></div>
<div id="page-weather" class="page">
<div id="weather-content"><div style="text-align:center; padding:50px;"><i class="fa-solid fa-spinner fa-spin"></i></div></div>
<div id="weather-details-container" style="display:none;">
<span class="section-label">ä»Šæ—¥æ™‚æ®µé å ± (3å°æ™‚)</span>
<div class="hourly-container" id="weather-hourly"></div>
<span class="section-label" style="margin-top:10px;">æ—…è¡Œè€…å»ºè­°</span>
<div class="advice-card">
<div class="advice-icon"><i class="fa-solid fa-shirt"></i></div>
<div class="advice-content"><h4>ç©¿æ­æŒ‡å—</h4><p id="weather-advice-text">è¼‰å…¥ä¸­...</p></div>
</div>
<span class="section-label">è©³ç´°æ•¸æ“š</span>
<div class="weather-grid">
<div class="weather-stat-card"><div class="ws-row"><span class="ws-label">æ¿•åº¦</span><i class="fa-solid fa-droplet ws-icon"></i></div><div class="ws-value" id="ws-humidity">--%</div><div class="ws-sub">æ˜“æ„Ÿæ¿•åº¦</div></div>
<div class="weather-stat-card"><div class="ws-row"><span class="ws-label">ç´«å¤–ç·š</span><i class="fa-solid fa-sun ws-icon"></i></div><div class="ws-value" id="ws-uv">--</div><div class="ws-sub">ç­‰ç´š</div></div>
<div class="weather-stat-card"><div class="ws-row"><span class="ws-label">æ—¥å‡º</span><i class="fa-regular fa-clock ws-icon"></i></div><div class="ws-value" id="ws-sunrise">--:--</div></div>
<div class="weather-stat-card"><div class="ws-row"><span class="ws-label">æ—¥è½</span><i class="fa-solid fa-moon ws-icon"></i></div><div class="ws-value" id="ws-sunset">--:--</div></div>
</div>
<div style="text-align:center; padding-bottom:30px; color:var(--text-sub); font-size:0.75rem;">è³‡æ–™ä¾†æº: Open-Meteo <span id="data-source-tag"></span></div>
</div>
</div>
<div id="page-info" class="page">
<div class="page-header"><h2 class="page-title">æ—…ç¨‹è³‡è¨Š</h2></div>
<div id="dynamic-info-content"></div>
</div>
<div id="page-phrases" class="page">
<div class="page-header"><h2 class="page-title">å¸¸ç”¨çŸ­èª</h2></div>
<div id="phrases-container"></div>
</div>
</main>
<nav class="bottom-nav">
<div class="nav-item active" onclick="switchMainPage('itinerary', this)"><i class="fa-regular fa-calendar-days"></i><span>è¡Œç¨‹</span></div>
<div class="nav-item" onclick="switchMainPage('inspiration', this)"><i class="fa-regular fa-compass"></i><span>éˆæ„Ÿ</span></div>
<div class="nav-item" onclick="switchMainPage('shopping', this)"><i class="fa-solid fa-bag-shopping"></i><span>æ¡è²·</span></div>
<div class="nav-item" onclick="switchMainPage('weather', this)"><i class="fa-solid fa-cloud-sun"></i><span>å¤©æ°£</span></div>
<div class="nav-item" onclick="switchMainPage('info', this)"><i class="fa-solid fa-sliders"></i><span>è³‡è¨Š</span></div>
</nav>
<div id="detail-modal" class="modal">
<div class="modal-content">
<div class="modal-handle-container" id="modal-drag-area"><div class="modal-handle"></div></div>
<div id="modal-mini-map"></div>
<div class="modal-body">
<div style="margin-bottom:15px;"><span class="modal-label" id="modal-type">Type</span><h2 id="modal-title" style="margin:0; font-size:1.4rem; font-family:var(--font-heading);">Title</h2></div>
<div class="modal-info-grid">
<div><span class="modal-label">æ™‚é–“</span><span class="modal-value" id="modal-time"></span></div>
<div><span class="modal-label">é ç®—</span><span class="modal-value" id="modal-price"></span></div>
<div><span class="modal-label">é–‹æ”¾æ™‚é–“</span><span class="modal-value" id="modal-open-hours"></span></div>
<div><span class="modal-label">åœ°å€</span><span class="modal-value" id="modal-address-short" style="font-size:0.9rem;"></span></div>
</div>
<div class="modal-label">å‚™è¨»</div><div class="modal-note-box"><div id="modal-note" class="modal-note-content"></div></div>
<div class="modal-actions" id="modal-actions"></div>
</div>
</div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// 1. ğŸ¨ æ‡‰ç”¨ä¸»é¡Œ
function applyTheme() {
const root = document.documentElement;
if(THEME_CONFIG.accentColor) root.style.setProperty('--accent', THEME_CONFIG.accentColor);
if(THEME_CONFIG.accentText) root.style.setProperty('--accent-text', THEME_CONFIG.accentText);
if(THEME_CONFIG.backgroundColor) root.style.setProperty('--bg-body', THEME_CONFIG.backgroundColor);
if(THEME_CONFIG.cardColor) root.style.setProperty('--bg-card', THEME_CONFIG.cardColor);
if(THEME_CONFIG.textColor) root.style.setProperty('--text-main', THEME_CONFIG.textColor);
if(THEME_CONFIG.textSubColor) root.style.setProperty('--text-sub', THEME_CONFIG.textSubColor);
if(THEME_CONFIG.borderColor) root.style.setProperty('--border', THEME_CONFIG.borderColor);
if(THEME_CONFIG.fontHeading) root.style.setProperty('--font-heading', THEME_CONFIG.fontHeading);
if(THEME_CONFIG.fontBody) root.style.setProperty('--font-body', THEME_CONFIG.fontBody);
if(THEME_CONFIG.googleFontsUrl) {
const link = document.createElement('link'); link.rel = 'stylesheet'; link.href = THEME_CONFIG.googleFontsUrl; document.head.appendChild(link);
}
}

// 2. ğŸ—“ï¸ ç”Ÿæˆæ—¥æœŸè³‡æ–™
function generateScheduleData() {
const dates = {};
const baseDate = new Date(CONFIG.startDate);
const duration = CONFIG.duration || 5;
const weekDays = ["é€±æ—¥", "é€±ä¸€", "é€±äºŒ", "é€±ä¸‰", "é€±å››", "é€±äº”", "é€±å…­"];
for(let i=0; i<duration; i++) {
const d = new Date(baseDate); d.setDate(baseDate.getDate() + i);
const dayKey = `day${i+1}`;
const yyyy = d.getFullYear(); const mm = String(d.getMonth() + 1).padStart(2, '0'); const dd = String(d.getDate()).padStart(2, '0');
const dailyData = USER_ITINERARY[dayKey] || { events:[], inspiration:[], shopping:[] };
dates[dayKey] = {
date: `${yyyy}-${mm}-${dd}`, display: dd, weekday: weekDays[d.getDay()],
events: dailyData.events || [],
inspiration: dailyData.inspiration || [],
shopping: dailyData.shopping || []
};
}
return dates;
}

// 3. ğŸš€ åˆå§‹åŒ–è®Šæ•¸
applyTheme();
const scheduleData = generateScheduleData();
let currentDay = "day1";
let modalMap = null;
let currentEventData = null;
let exchangeRate = 0.053;
let weatherCache = null;
let shopState = {};

// 4. å•Ÿå‹•ç¨‹å¼
function init() {
document.title = CONFIG.ui.browserTitle || "Travel App";
document.getElementById('app-title').innerHTML = CONFIG.ui.headerTitle || "TRIP PLANNER";
document.getElementById('lbl-curr-target').innerText = DESTINATION.currencyLabel;
document.getElementById('lbl-curr-base').innerText = DESTINATION.baseCurrency;

renderDateSelector();
selectDay('day1');
switchMainPage('itinerary', document.querySelector('.nav-item.active'));
fetchRates();

if(localStorage.getItem('travelMemo')) document.getElementById('quick-memo').value = localStorage.getItem('travelMemo');
if(localStorage.getItem('shopState')) shopState = JSON.parse(localStorage.getItem('shopState'));

document.getElementById('quick-memo').addEventListener('input', function() { localStorage.setItem('travelMemo', this.value); });

renderInfoPage();
renderPhrasePage();
initSwipeClose();
setInterval(updateHomeClock, 1000);
updateHomeClock();
}

function updateHomeClock() {
if(!CONFIG.ui.homeTimezone) return;
const options = { timeZone: CONFIG.ui.homeTimezone, hour: '2-digit', minute: '2-digit', hour12: false };
const timeString = new Date().toLocaleTimeString('en-US', options);
document.getElementById('home-clock').innerText = `${CONFIG.ui.homeTimeLabel} ${timeString}`;
}

// 5. æ¸²æŸ“å„å€‹é é¢å…ƒä»¶
function renderInfoPage() {
const container = document.getElementById('dynamic-info-content');
if(!container) return;
let html = '';

// Visa
if(TRIP_INFO.visa && TRIP_INFO.visa.number) {
html += `<div class="info-card"><div class="info-header">ç°½è­‰è³‡æ–™ (Visa)</div>`;
html += `<div class="info-row"><div><span class="info-label">é¡å‹</span><div>${TRIP_INFO.visa.type}</div></div></div>`;
html += `<div class="info-row" style="align-items:center; justify-content:space-between;"><div><span class="info-label">è™Ÿç¢¼</span><div style="font-weight:600;">${TRIP_INFO.visa.number}</div></div><button class="btn-copy-text" onclick="copyToClipboard('${TRIP_INFO.visa.number}')">è¤‡è£½</button></div>`;
html += `<div class="info-row" style="margin-top:15px;"><div><span class="info-label">æœ‰æ•ˆæœŸ</span><div>${TRIP_INFO.visa.expiry || '-'}</div></div></div>`;
if(TRIP_INFO.visa.note) html += `<div class="info-row" style="color:var(--text-sub); font-size:0.85rem;"><i class="fa-solid fa-circle-info" style="margin-right:5px;"></i> ${TRIP_INFO.visa.note}</div>`;
html += `</div>`;
}

// Flights
if(TRIP_INFO.flights && TRIP_INFO.flights.length > 0) {
html += `<div class="info-card"><div class="info-header">èˆªç­è³‡æ–™</div><div class="flight-grid">`;
TRIP_INFO.flights.forEach(f => {
const icon = f.type === "å»ç¨‹" ? "fa-plane-departure" : "fa-plane-arrival";
let bookingHtml = f.bookingRef ? `<div class="flight-meta" style="color:var(--text-main); font-weight:600; margin-top:6px;">${f.bookingRef} <i class="fa-regular fa-copy" style="cursor:pointer; margin-left:5px;" onclick="copyToClipboard('${f.bookingRef}')"></i></div>` : '';
html += `<div class="flight-row"><div class="flight-leg"><div class="flight-meta"><i class="fa-solid ${icon}"></i> ${f.type} (${f.date})</div><div class="flight-code">${f.flight}</div>${bookingHtml}<div class="flight-meta">${f.note}</div></div><div style="text-align:right;"><div class="flight-time">${f.dep}</div><div class="flight-arrow">â†“</div><div class="flight-time">${f.arr}</div></div></div>`;
});
html += `</div></div>`;
}

// Hotels
if(TRIP_INFO.hotels && TRIP_INFO.hotels.length > 0) {
html += `<div class="info-card"><div class="info-header">ä½å®¿</div>`;
TRIP_INFO.hotels.forEach(h => {
html += `<div class="info-row"><div class="info-icon"><i class="fa-solid fa-hotel"></i></div><div><span class="info-label">é…’åº—</span><div>${h.name}</div></div></div>`;
html += `<div class="info-row"><div class="info-icon"><i class="fa-solid fa-location-dot"></i></div><div><span class="info-label">åœ°å€</span><div>${h.address}</div><button class="nav-link" style="margin-top:5px; padding:5px 10px; border:1px solid var(--border); background:var(--bg-card); border-radius:4px;" onclick="copyToClipboard('${h.address}')">è¤‡è£½åœ°å€</button></div></div>`;
if(h.phone) {
html += `<div class="info-row"><div class="info-icon"><i class="fa-solid fa-phone"></i></div><div><span class="info-label">é›»è©±</span><div class="contact-container"><span style="margin-right:10px;">${h.phone}</span><a href="javascript:void(0)" onclick="callNumber('${h.phone}')" class="btn-icon-sm btn-call"><i class="fa-solid fa-phone"></i></a></div></div></div>`;
}
html += `<div style="height:1px; background:var(--border); margin:15px 0;"></div>`;
});
html += `</div>`;
}

// Emergency
if(TRIP_INFO.emergency && TRIP_INFO.emergency.length > 0) {
html += `<div class="info-card"><div class="info-header">ç·Šæ€¥è¯çµ¡</div>`;
TRIP_INFO.emergency.forEach(e => {
const icon = e.name.includes("è­¦") ? "fa-shield-halved" : "fa-truck-medical";
html += `<div class="info-row"><div class="info-icon"><i class="fa-solid ${icon}"></i></div><div style="width:100%; display:flex; justify-content:space-between; align-items:center;"><div><span class="info-label">${e.name}</span><span>${e.phone}</span></div><a href="javascript:void(0)" onclick="callNumber('${e.phone}')" class="btn-icon-sm btn-call"><i class="fa-solid fa-phone"></i></a></div></div>`;
});
html += `</div>`;
}
container.innerHTML = html;
}

function showToast(msg) { const t = document.getElementById('toast'); document.getElementById('toast-msg').innerText = msg; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2000); }

async function fetchRates(force = false) {
const statusEl = document.getElementById('rate-status'); statusEl.innerText = 'æ›´æ–°ä¸­...';
try {
const res = await fetch(`https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/${DESTINATION.currency}.json`);
const data = await res.json();
const rate = data[DESTINATION.currency][DESTINATION.baseCurrency.toLowerCase()];
if(rate) { exchangeRate = rate; statusEl.innerHTML = `1 ${DESTINATION.baseCurrency} = ${(1/exchangeRate).toFixed(2)} ${DESTINATION.currencyLabel}`; convertCurrency(); if(force) showToast("åŒ¯ç‡å·²æ›´æ–°"); }
} catch(e) { statusEl.innerText = 'é›¢ç·šæ¨¡å¼'; }
}
function convertCurrency() { const jpy = parseFloat(document.getElementById('curr-jpy').value); if(!isNaN(jpy)) { document.getElementById('curr-hkd').value = (jpy * exchangeRate).toFixed(1); } else { document.getElementById('curr-hkd').value = ""; } }

async function fetchWeather() {
const lat = DESTINATION.lat; const lon = DESTINATION.lon; const targetDateStr = scheduleData[currentDay].date;
const today = new Date(); const targetDate = new Date(targetDateStr);
const diffTime = targetDate - today; const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
let url = ""; let isArchive = false;
const tz = encodeURIComponent(DESTINATION.timezone);
if (diffDays >= -1 && diffDays <= 15) { url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&daily=weathercode,temperature_2m_max,temperature_2m_min,precipitation_probability_max,sunrise,sunset,uv_index_max&hourly=temperature_2m,weathercode,precipitation_probability,relative_humidity_2m&timezone=${tz}&forecast_days=16`; }
else { isArchive = true; const pastYear = targetDate.getFullYear() - 1; const pastDateStr = targetDateStr.replace(/^\d{4}/, pastYear); url = `https://archive-api.open-meteo.com/v1/archive?latitude=${lat}&longitude=${lon}&start_date=${pastDateStr}&end_date=${pastDateStr}&daily=weathercode,temperature_2m_max,temperature_2m_min,sunrise,sunset&hourly=temperature_2m,weathercode,relative_humidity_2m&timezone=${tz}`; }
try {
const res = await fetch(url); const data = await res.json();
if(isArchive) { if(!data.daily.precipitation_probability_max) data.daily.precipitation_probability_max = [20]; if(!data.daily.uv_index_max) data.daily.uv_index_max = [3]; if(!data.hourly.precipitation_probability) data.hourly.precipitation_probability = new Array(24).fill(0); }
weatherCache = data; weatherCache.isArchive = isArchive;
localStorage.setItem('weatherLastFetch', new Date().getTime());
if(document.getElementById('page-weather').classList.contains('active')) renderWeatherModule();
} catch(e) { console.error(e); document.getElementById('weather-content').innerHTML = "<div style='text-align:center; padding:30px;'>æš«æ™‚ç„¡æ³•å–å¾—å¤©æ°£</div>"; }
}

function renderWeatherModule() {
const container = document.getElementById('weather-content'); const details = document.getElementById('weather-details-container'); const sourceTag = document.getElementById('data-source-tag');
if(!weatherCache || !weatherCache.daily) { container.innerHTML = "<div style='text-align:center; padding:30px;'>ç„¡å¤©æ°£è³‡æ–™</div>"; return; }
let apiIndex = 0;
if(!weatherCache.isArchive) { const targetDate = scheduleData[currentDay].date; apiIndex = weatherCache.daily.time.indexOf(targetDate); if (apiIndex === -1) { container.innerHTML = `<div style='text-align:center; padding:40px;'>å°šç„¡é å ±</div>`; return; } }
const d = weatherCache.daily; const code = d.weathercode[apiIndex];
const wmo = { 0:{i:'fa-sun',t:'æ™´æœ—'}, 1:{i:'fa-cloud-sun',t:'å¤šé›²'}, 2:{i:'fa-cloud-sun',t:'å¤šé›²'}, 3:{i:'fa-cloud',t:'é™°å¤©'}, 45:{i:'fa-smog',t:'éœ§'}, 51:{i:'fa-cloud-rain',t:'æ¯›æ¯›é›¨'}, 61:{i:'fa-cloud-showers-heavy',t:'é™£é›¨'}, 80:{i:'fa-cloud-showers-water',t:'é›·é™£é›¨'}, 95:{i:'fa-bolt',t:'é›·é›¨'} };
const w = wmo[code] || {i:'fa-cloud',t:'å¤šé›²'};
const maxTemp = Math.round(d.temperature_2m_max[apiIndex]); const minTemp = Math.round(d.temperature_2m_min[apiIndex]); const rainProb = d.precipitation_probability_max ? d.precipitation_probability_max[apiIndex] : 0; const tagText = weatherCache.isArchive ? "æ­·å²å¹³å‡ (å»å¹´)" : "å³æ™‚é å ±";
container.innerHTML = `<div class="weather-main-card"><div class="weather-tag-badge">${tagText}</div><div class="weather-header-row"><div><div class="weather-condition"><i class="fa-solid fa-location-arrow" style="font-size:0.8rem;"></i> ${DESTINATION.name}</div><div class="weather-hl">H:${maxTemp}Â° L:${minTemp}Â°</div></div><div class="weather-main-icon" style="color:inherit"><i class="fa-solid ${w.i}"></i></div></div><div class="weather-big-temp">${maxTemp}Â°</div><div style="font-weight:500;">${w.t} â€¢ é™é›¨ ${rainProb}%</div></div>`;
const hContainer = document.getElementById('weather-hourly'); hContainer.innerHTML = '';
const startHour = weatherCache.isArchive ? 0 : apiIndex * 24;
[9, 12, 15, 18, 21].forEach(hour => {
const idx = startHour + hour;
if(weatherCache.hourly.time[idx] || (weatherCache.isArchive && idx < 24)) {
const hTemp = Math.round(weatherCache.hourly.temperature_2m[idx]); const hRain = weatherCache.hourly.precipitation_probability ? weatherCache.hourly.precipitation_probability[idx] : 0; const hCode = weatherCache.hourly.weathercode[idx]; const hw = wmo[hCode] || {i:'fa-cloud'};
hContainer.innerHTML += `<div class="hourly-item"><div class="hourly-time">${hour}:00</div><div class="hourly-icon"><i class="fa-solid ${hw.i}"></i></div><div class="hourly-temp">${hTemp}Â°</div><div class="hourly-rain">${hRain > 20 ? hRain + '%' : ''}</div></div>`;
}
});
let advice = "";
if (rainProb > 40) advice += "æ”œå¸¶é›¨å…·ï¼šé™é›¨æ©Ÿç‡é«˜ï¼Œè«‹éš¨èº«æ”œå¸¶æŠ˜å‚˜ã€‚<br>"; if (maxTemp < 5) advice += "æ¥µå¯’ä¿æš–ï¼šå»ºè­°ç©¿è‘—ç¾½çµ¨æœã€åœå·¾ã€æ‰‹å¥—ï¼Œä¸¦ä½¿ç”¨æš–æš–åŒ…ã€‚<br>"; else if (maxTemp < 12) advice += "æ´‹è”¥ç©¿æ­ï¼šæ—©æ™šæº«å·®å¤§ï¼Œå»ºè­°å¤§è¡£æ­é…ç™¼ç†±è¡£ã€‚<br>"; else advice += "èˆ’é©æ¶¼çˆ½ï¼šç©¿è‘—è¼•ä¾¿å¤–å¥—å³å¯ã€‚<br>"; if (d.uv_index_max && d.uv_index_max[apiIndex] > 5) advice += "æ³¨æ„é˜²æ›¬ï¼šç´«å¤–ç·šè¼ƒå¼·ã€‚";
document.getElementById('weather-advice-text').innerHTML = advice || "å¤©æ°£èˆ’é©ï¼Œé©åˆæ—…éŠçš„ä¸€å¤©ï¼";
const noonIdx = startHour + 12; document.getElementById('ws-humidity').innerText = weatherCache.hourly.relative_humidity_2m[noonIdx] + '%'; document.getElementById('ws-uv').innerText = d.uv_index_max ? d.uv_index_max[apiIndex] : "-"; document.getElementById('ws-sunrise').innerText = d.sunrise[apiIndex].split('T')[1]; document.getElementById('ws-sunset').innerText = d.sunset[apiIndex].split('T')[1];
sourceTag.innerText = weatherCache.isArchive ? "(æ­·å²å›æº¯æ¨¡å¼)" : "(å³æ™‚é å ±)"; details.style.display = 'block';
}

function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); document.getElementById('sidebar-overlay').classList.toggle('open'); }
function openTranslate() { window.open("https://translate.google.com/?sl=auto&tl=zh-TW", "_blank"); }

function switchMainPage(pageId, navEl) {
document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
document.getElementById('page-' + pageId).classList.add('active');
document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
if(navEl) navEl.classList.add('active');
const ds = document.querySelector('.date-selector-container');
if(pageId === 'info' || pageId === 'phrases') ds.style.display = 'none'; else ds.style.display = 'block';
if(pageId === 'weather') {
const now = new Date().getTime(); const lastFetch = localStorage.getItem('weatherLastFetch');
if (!weatherCache || !lastFetch || (now - lastFetch > 3600000)) fetchWeather(); else renderWeatherModule();
}
}

function openPhrasePage() { toggleSidebar(); switchMainPage('phrases'); }
function renderPhrasePage() {
const container = document.getElementById('phrases-container'); container.innerHTML = '';
PHRASE_DATA.forEach(category => {
container.innerHTML += `<div class="phrase-section-header">${category.category}</div>`;
let gridHtml = '<div class="phrase-grid">';
category.items.forEach(item => {
gridHtml += `<div class="phrase-card" onclick="showPhrase('${item.term_primary}', '${item.term_secondary}')">
<div class="phrase-primary">${item.term_primary}</div>
<div class="phrase-secondary">${item.term_secondary}</div>
<div class="phrase-pronounce">${item.term_pronounce || ''}</div>
</div>`;
});
gridHtml += '</div>';
container.innerHTML += gridHtml;
});
}

function sendWhatsApp() {
let phone = document.getElementById('wa-phone').value.replace(/\D/g, '');
if(!phone) { alert("è«‹è¼¸å…¥é›»è©±"); return; }
if (navigator.geolocation) {
const btn = document.getElementById('wa-btn'); const orgText = btn.innerHTML; btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> å®šä½ä¸­...';
navigator.geolocation.getCurrentPosition((pos) => {
const mapLink = `https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`;
const text = `æˆ‘å¹³å®‰æŠµé”äº†ï¼ä½ç½®ï¼š${mapLink}`;
window.location.href = `https://wa.me/${phone}?text=${encodeURIComponent(text)}`;
btn.innerHTML = orgText;
}, (err) => { alert("ç„¡æ³•å®šä½: " + err.message); btn.innerHTML = orgText; }, { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 });
} else { alert("ç€è¦½å™¨ä¸æ”¯æ´å®šä½"); }
}

// ğŸ—ºï¸ åœ°åœ–é€£çµå„ªåŒ– (Universal Links)
function openMapQuery(address) {
const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
const query = encodeURIComponent(address);
const url = isMobileÂ 
Â  Â  ? `https://www.google.com/maps/search/?api=1&query=${query}`
Â  Â  : `https://www.google.com/maps/search?q=${query}`;
window.open(url, '_blank');
}

function callNumber(num) { window.location.href = `tel:${num}`; }
function copyToClipboard(text) { navigator.clipboard.writeText(text).then(() => { showToast("å·²è¤‡è£½"); }); }
function searchGmail(query) { window.open(`https://mail.google.com/mail/u/0/#search/${encodeURIComponent(query)}`, '_blank'); }

function openModal(data) {
currentEventData = data;
document.getElementById('modal-title').innerText = data.title;
document.getElementById('modal-type').innerText = data.type || "Note";
document.getElementById('modal-time').innerText = data.time || "--:--";
document.getElementById('modal-price').innerText = data.price || "-";
document.getElementById('modal-open-hours').innerText = data.open_hours || "å¾…ç¢ºèª";
document.getElementById('modal-address-short').innerText = data.address || "";
document.getElementById('modal-note').innerText = data.note || "";

// è¯çµ¡é›»è©±è™•ç†
const infoGrid = document.querySelector('.modal-info-grid');
const existingPhone = document.getElementById('dynamic-phone-row');
if(existingPhone) existingPhone.remove();

if(data.phone) {
const phoneRow = document.createElement('div'); phoneRow.id = 'dynamic-phone-row';
phoneRow.innerHTML = `<span class="modal-label">é›»è©±</span><div class="contact-container"><span class="modal-value" style="margin-right:10px;">${data.phone}</span><a href="javascript:void(0)" onclick="callNumber('${data.phone}')" class="btn-icon-sm" style="border:1px solid var(--border);"><i class="fa-solid fa-phone"></i></a></div>`; infoGrid.appendChild(phoneRow);
}

// æŒ‰éˆ•å€è™•ç†
const actionsContainer = document.getElementById('modal-actions');
actionsContainer.innerHTML = '';
const addr = data.address_local || data.address;

// åªæœ‰ç•¶æœ‰åœ°å€æ™‚ï¼Œæ‰é¡¯ç¤ºè¤‡è£½èˆ‡å°èˆª
if(addr) {
actionsContainer.innerHTML += `<button class="btn-action btn-outline" onclick="copyToClipboard('${addr}')"><i class="fa-regular fa-copy"></i> è¤‡è£½åœ°å€</button>`;
actionsContainer.innerHTML += `<button class="btn-action btn-black" onclick="openMapQuery('${data.address}')"><i class="fa-solid fa-location-arrow"></i> Google Maps å°èˆª</button>`;
if (data.type === 'ä½å®¿' || data.type === 'äº¤é€š') { actionsContainer.innerHTML += `<button class="btn-action btn-outline" onclick="showPhrase('${addr}', 'è«‹è¼‰æˆ‘å»é€™è£¡')">ğŸš• é¡¯ç¤ºçš„å£«å¡</button>`; }
}

// æœå°‹é ç´„ä¿¡ (ç¸½æ˜¯é¡¯ç¤º)
if (data.type === 'ç¾é£Ÿ' || data.type === 'æ™šé¤' || data.type === 'åˆé¤' || data.type === 'æ—©é¤' || data.type === 'ä½å®¿') {
actionsContainer.innerHTML += `<button class="btn-action btn-outline" onclick="searchGmail('${data.title}')">ğŸ” æœå°‹é ç´„ä¿¡ (Gmail)</button>`;
}

document.getElementById('detail-modal').classList.add('open');

// åœ°åœ–è™•ç†
const miniMapContainer = document.getElementById('modal-mini-map');
if(!data.coords && !data.address) {
miniMapContainer.style.display = 'none';
} else {
miniMapContainer.style.display = 'block';
setTimeout(() => {
if(modalMap) modalMap.remove();
const targetCoords = data.coords || [DESTINATION.lat, DESTINATION.lon];
modalMap = L.map('modal-mini-map', {zoomControl:false, dragging:false, attributionControl: false}).setView(targetCoords, 15);
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(modalMap);
if(data.coords) {
L.marker(data.coords, {icon: L.divIcon({className:'custom-div-icon',html:"<div style='background:black;width:12px;height:12px;border-radius:50%;border:2px solid white;box-shadow:0 2px 5px rgba(0,0,0,0.3);'></div>",iconSize:[12,12]})}).addTo(modalMap);
}
modalMap.invalidateSize();
}, 150);
}
}

function closeModal() { document.getElementById('detail-modal').classList.remove('open'); document.querySelector('.modal-content').style.transform = ''; }
document.getElementById('detail-modal').addEventListener('click', function(e) { if (e.target === this) closeModal(); });

function initSwipeClose() {
const modalContent = document.querySelector('.modal-content'); const dragArea = document.getElementById('modal-drag-area');
let startY = 0; let currentY = 0;
dragArea.addEventListener('touchstart', (e) => { startY = e.touches[0].clientY; modalContent.style.transition = 'none'; });
dragArea.addEventListener('touchmove', (e) => { currentY = e.touches[0].clientY; const delta = currentY - startY; if(delta > 0) modalContent.style.transform = `translateY(${delta}px)`; });
dragArea.addEventListener('touchend', () => { const delta = currentY - startY; modalContent.style.transition = 'transform 0.3s ease-out'; if(delta > 100) closeModal(); else modalContent.style.transform = ''; });
}
function renderDateSelector() { const container = document.getElementById('date-selector'); container.innerHTML = ''; Object.keys(scheduleData).forEach(dayKey => { const day = scheduleData[dayKey]; const chip = document.createElement('div'); chip.className = `date-chip`; chip.id = `chip-${dayKey}`; chip.onclick = () => selectDay(dayKey, chip); chip.innerHTML = `<span class="day-num">${day.display}</span><span class="day-week">${day.weekday}</span>`; container.appendChild(chip); }); }

function selectDay(dayKey, chipEl) { currentDay = dayKey; document.querySelectorAll('.date-chip').forEach(c => c.classList.remove('active')); (chipEl || document.getElementById(`chip-${dayKey}`)).classList.add('active'); if(chipEl) chipEl.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' }); renderTimeline(dayKey); renderInspiration(dayKey); renderShopping(dayKey); if(document.getElementById('page-weather').classList.contains('active')) fetchWeather(); }

function renderTimeline(dayKey) {
const container = document.getElementById('timeline-container'); container.innerHTML = '';
(scheduleData[dayKey].events || []).forEach(event => {
const item = document.createElement('div'); item.className = 'timeline-item';
let tags = event.tags.map(t => `<span class="card-tag">${t}</span>`).join('');
const safeData = JSON.stringify(event).replace(/'/g, "'");
const navBtn = `<div class="card-nav-btn" onclick="event.stopPropagation(); openMapQuery('${event.address}')"><i class="fa-solid fa-location-arrow"></i></div>`;
const colorStyle = event.moodColor ? `border-left-color: ${event.moodColor};` : 'border-left-color: var(--accent);';
item.innerHTML = `<div class="card" style="${colorStyle}" onclick='openModal(${safeData})'>${navBtn}<span class="card-time">${event.time}</span><h3 class="card-title">${event.title}</h3><div class="tags">${tags}</div></div>`;
container.appendChild(item);
});
if(!scheduleData[dayKey].events.length) container.innerHTML = "<div style='text-align:center; padding:50px; color:var(--text-sub);'>æœ¬æ—¥ç„¡è¡Œç¨‹ï¼Œè‡ªç”±æ¢ç´¢ï¼</div>";
}

function renderInspiration(dayKey) {
const container = document.getElementById('inspiration-container'); container.innerHTML = '';
(scheduleData[dayKey].inspiration || []).forEach(item => {
const safeData = JSON.stringify(item).replace(/'/g, "'");
const clickAttr = `onclick='openModal(${safeData})'`;
container.innerHTML += `<div class="inspire-card" data-tag="${item.tag}" ${clickAttr}><div class="inspire-badge">${item.tag}</div><h3 class="inspire-title">${item.title}</h3><p class="inspire-note">${item.note}</p></div>`;
});
if(!scheduleData[dayKey].inspiration.length) container.innerHTML = "<div style='text-align:center; padding:30px; color:var(--text-sub);'>æœ¬æ—¥ç„¡éˆæ„Ÿç­†è¨˜</div>";
}

function filterInspiration(tag, btn) { document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active')); btn.classList.add('active'); document.querySelectorAll('.inspire-card').forEach(card => { if(tag === 'all' || card.getAttribute('data-tag') === tag) card.classList.remove('hidden'); else card.classList.add('hidden'); }); }
function renderShopping(dayKey) { const container = document.getElementById('shopping-container'); container.innerHTML = ''; const items = scheduleData[dayKey].shopping || []; if(items.length === 0) { container.innerHTML = "<div style='color:var(--text-sub); text-align:center; padding:20px;'>ç„¡å¾…è²·æ¸…å–®</div>"; return; } items.forEach((item, idx) => { const uniqueId = `${dayKey}-${idx}`; const isChecked = shopState[uniqueId] ? 'checked' : ''; const div = document.createElement('div'); div.className = `shop-item ${isChecked ? 'checked' : ''}`; div.innerHTML = `<input type="checkbox" id="${uniqueId}" ${isChecked} onchange="toggleShopItem(this, '${uniqueId}')"><label for="${uniqueId}">${item}</label>`; container.appendChild(div); }); }
function toggleShopItem(checkbox, id) { shopState[id] = checkbox.checked; localStorage.setItem('shopState', JSON.stringify(shopState)); checkbox.closest('.shop-item').classList.toggle('checked'); }
function showPhrase(jp, zh) { document.getElementById('overlay-jp').innerText = jp; document.getElementById('overlay-zh').innerText = zh; document.getElementById('phrase-overlay').classList.add('active'); }
function closePhrase() { document.getElementById('phrase-overlay').classList.remove('active'); }

init();
</script>
</body>
</html>
